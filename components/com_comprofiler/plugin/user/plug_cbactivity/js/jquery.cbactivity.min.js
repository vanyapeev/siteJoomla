(function(e){var t=[];var a={init:function(a){return this.each(function(){var m=this;var h=e(m).data("cbactivity");if(h){return}h={};h.options=typeof a!="undefined"?a:{};h.defaults=e.fn.cbactivity.defaults;h.settings=e.extend(true,{},h.defaults,h.options);h.element=e(m);if(h.settings.useData){e.each(h.defaults,function(e,t){if(e!="init"&&e!="useData"){var a=h.element.data("cbactivity"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof a!="undefined"){h.settings[e]=a}else{a=h.element.data("cbactivity"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof a!="undefined"){h.settings[e]=a}}}})}h.element.triggerHandler("cbactivity.init.before",[h]);if(!h.settings.init){return}e.ajaxPrefilter(function(e,t,a){e.async=true});h.actinHandler=function(t){t.preventDefault();var a=e(this);if(a.hasClass("streamRequesting")){return}var i=n.call(a,h);if(!i.length){return}var s=a.data("cbactivity-action-url");if(!s){s=a.attr("href")}if(!s){return}var c=a.data("cbactivity-action-output");var f=a.data("cbactivity-action-target");var m=a.data("cbactivity-confirm");var u=a.data("cbactivity-confirm-button");var v=a.data("cbactivity-action-overlay")!=false;var p=a.data("cbactivity-action-fade")!=false;a.addClass("streamRequesting");var g=function(){e.ajax({url:s,type:"GET",dataType:"html",beforeSend:function(e,t,l){if(v){i.addClass("streamOverlay")}h.element.triggerHandler("cbactivity.action.send",[h,a,i,e,t,l])}}).fail(function(e,t,l){if(v){i.removeClass("streamOverlay")}a.removeClass("streamRequesting");h.element.triggerHandler("cbactivity.action.error",[h,a,i,e,t,l])}).done(function(t,n,s){if(v){i.removeClass("streamOverlay")}a.removeClass("streamRequesting");var m=null;try{m=JSON.parse(t)}catch(e){m={message:t,type:null,output:null,target:null}}var u=typeof m.message!=="undefined"?m.message:null;var g=null;l.call(i.find(".streamItemAlert"),h).remove();var b=h.element;if(m&&u){var y=[];var I=c?c:typeof m.output!=="undefined"?m.output:null;var C=f?f:typeof m.target!=="undefined"?m.target:null;if(I||C){var H=null;if(C){if(C=="self"){H=a}else if(C=="items"){H=i.siblings(".streamItems")}else if(C=="container"){H=i}else if(C=="stream"){H=h.element}else{C=l.call(i.find(C),h);if(C.length){H=C}}}else{H=a}g=e(u);if(p){g.hide()}y=o.call(g,h);switch(I){case"before":H.before(g);break;case"after":H.after(g);break;case"prepend":H.prepend(g);break;case"append":H.append(g);break;case"replace":default:if(C=="container"){H.siblings(".streamItemHeaders").remove()}else if(C=="stream"){b=h.element.clone(true)}H.replaceWith(g);if(C=="container"){i=g}else if(C=="stream"){h.element=g}break}}else{g=e('<div class="streamItemActionResponse">'+u+"</div>");if(p){g.hide()}y=o.call(g,h);i.children().addClass("hidden");i.children(".streamItemActionResponse").remove();i.append(g)}d.call(g,h,y);if(p){g.fadeIn("slow")}}else{if(a.hasClass("streamItemActionResponseRevert")){i.children().removeClass("hidden").hide().fadeIn("slow");i.children(".streamItemActionResponse").remove()}else{i.siblings(".streamItemHeaders").remove();i.remove()}}b.triggerHandler("cbactivity.action.success",[h,a,i,g,m,t,n,s]);if(m&&u){r.call(i,h,true)}})};if(m){e.cbconfirm(m,{buttonYes:u}).done(g).fail(function(){a.removeClass("streamRequesting")})}else{g()}};e(document).on("click.cbactivity",".streamItemAction",h.actinHandler);h.cancelNewHandler=function(e){e.preventDefault();c.call(this,h)};h.saveHandler=function(t){t.preventDefault();var a=e(this);if(a.hasClass("streamRequesting")){return false}var i=n.call(a,h);if(!i.length){return false}var s=typeof i.data("cbactivity-id")=="undefined";a.ajaxSubmit({type:"POST",dataType:"html",beforeSend:function(e,t,l){i.addClass("streamOverlay");a.addClass("streamRequesting");h.element.triggerHandler("cbactivity.save.send",[h,a,i,s,e,t,l])},error:function(e,t,l){i.removeClass("streamOverlay");a.removeClass("streamRequesting");h.element.triggerHandler("cbactivity.save.error",[h,a,i,s,e,t,l])},success:function(t,n,f){i.removeClass("streamOverlay");a.removeClass("streamRequesting");var m=null;try{m=JSON.parse(t)}catch(e){m={message:t,type:null,output:null,target:null}}var u=typeof m.message!=="undefined"?m.message:null;l.call(i.find(".streamItemAlert"),h).remove();var v=h.element;if(m&&u){var p=e(u).hide();var g=o.call(p,h);var b=typeof m.output!=="undefined"?m.output:null;var y=typeof m.target!=="undefined"?m.target:null;if(b||y){var I=null;if(y){if(y=="self"){I=a}else if(y=="items"){I=i.siblings(".streamItems")}else if(y=="container"){I=i}else if(y=="stream"){I=h.element}else{y=l.call(i.find(y),h);if(y.length){I=y}}}else{I=a}switch(b){case"before":I.before(p);break;case"after":I.after(p);break;case"prepend":I.prepend(p);break;case"append":I.append(p);break;case"replace":default:if(y=="container"){I.siblings(".streamItemHeaders").remove()}else if(y=="stream"){v=h.element.clone(true)}I.replaceWith(p);if(y=="container"){i=p}else if(y=="stream"){h.element=p}break}}else{if(s){c.call(a,h);var C=i.siblings(".streamItems");l.call(C.children(".streamEmpty"),h).remove();var H=null;if(h.settings.direction=="up"){H=l.call(C.find(".streamItem[data-cbactivity-id]:not(.streamItemPinned):last"),h)}else{H=l.call(C.find(".streamItem[data-cbactivity-id]:not(.streamItemPinned):first"),h)}if(h.settings.direction=="up"){if(H.length){p.insertAfter(H)}else{C.append(p)}}else{if(H.length){p.insertBefore(H)}else{C.prepend(p)}}}else{i.siblings(".streamItemHeaders").remove();i.replaceWith(p)}i=p}d.call(p,h,g);p.fadeIn("slow")}v.triggerHandler("cbactivity.save.success",[h,a,i,p,s,m,t,n,f]);if(m&&u){r.call(i,h,true)}}});return false};h.closeActionsHandler=function(t){t.preventDefault();var a=e(this);if(a.hasClass("streamItemAction")){return}var i=n.call(a,h);if(!i.length){return}i.siblings(".streamItemHeaders").remove();i.remove();h.element.triggerHandler("cbactivity.actions.close",[h,a,i])};h.revertActionsHandler=function(t){t.preventDefault();var a=e(this);if(a.hasClass("streamItemAction")){return}var i=n.call(a,h);if(!i.length){return}i.children().removeClass("hidden");l.call(i.find(".streamItemActionResponse"),h).remove();l.call(i.find(".streamItemAlert"),h).remove();h.element.triggerHandler("cbactivity.actions.revert",[h,a,i])};h.closeActionHandler=function(t){t.preventDefault();var a=e(this);if(a.hasClass("streamItemAction")){return}var i=n.call(a,h);if(!i.length){return}l.call(a.closest(".streamItemActionResponse"),h).remove();h.element.triggerHandler("cbactivity.action.close",[h,a,i])};h.displayNewHandler=function(t){var a=e(this);var i=n.call(a,h);if(!i.length){return}var s=l.call(i.find(".streamItemDisplay"),h);if(!s.hasClass("hidden")){return}var c=l.call(i.find(".streamInputMessage"),h);var o=c.data("cbactivity-input-size");if(typeof o!="undefined"){c.attr("rows",o)}s.removeClass("hidden");h.element.triggerHandler("cbactivity.new.display",[h,a,i]);r.call(i,h)};h.messageLimitHandler=function(t){var a=e(this);var i=n.call(a,h);if(!i.length){return}var r=a.data("cbactivity-input-limit");if(typeof r!="undefined"){var s=a.val().length;if(s>r){a.val(a.val().substr(0,r))}else{l.call(i.find(".streamInputMessageLimitCurrent"),h).html(a.val().length)}}};h.scrollerLeftHandler=function(t){t.preventDefault();var a=e(this);var i=n.call(a,h);if(!i.length){return}var l=a.closest(".streamItemScroll");var s=l.children(".streamItemScrollContent:not(.hidden)");var c=s.prevAll(".streamItemScrollContent.hidden:first");if(!c.length){c=l.children(".streamItemScrollContent.hidden:last")}if(!c.length){return}c.removeClass("hidden");s.addClass("hidden");l.children(".streamItemScrollContent").find(".streamItemScrollDisable").addClass("disabled").prop("disabled",true);l.children(".streamItemScrollContent").find(".streamItemScrollHide").addClass("hidden");c.find(".streamItemScrollDisable").removeClass("disabled").prop("disabled",false);c.find(".streamItemScrollHide").removeClass("hidden");r.call(i,h)};h.scrollerRightandler=function(t){t.preventDefault();var a=e(this);var i=n.call(a,h);if(!i.length){return}var l=a.closest(".streamItemScroll");var s=l.children(".streamItemScrollContent:not(.hidden)");var c=s.nextAll(".streamItemScrollContent.hidden:first");if(!c.length){c=l.children(".streamItemScrollContent.hidden:first")}if(!c.length){return}c.removeClass("hidden");s.addClass("hidden");l.children(".streamItemScrollContent").find(".streamItemScrollDisable").addClass("disabled").prop("disabled",true);l.children(".streamItemScrollContent").find(".streamItemScrollHide").addClass("hidden");c.find(".streamItemScrollDisable").removeClass("disabled").prop("disabled",false);c.find(".streamItemScrollHide").removeClass("hidden");r.call(i,h)};h.locationHandler=function(t){t.preventDefault();var a=e(this);var i=n.call(a,h);if(!i.length){return}var r=a.data("cbactivity-location-target");var s=a.data("cbactivity-location-error");var c=a.data("cbactivity-location-filter")!=false;if(typeof r=="undefined"){if(typeof s!="undefined"){e.cbconfirm(s,{buttonNo:false})}return}if(typeof navigator.geolocation=="undefined"){if(typeof s!="undefined"){e.cbconfirm(s,{buttonNo:false})}return}navigator.geolocation.getCurrentPosition(function(e){var t=e.coords.latitude+","+e.coords.longitude;var a=i.find(r);if(c){a=l.call(a,h)}if(a.is("input")){a.val(t)}else{a.html(t)}},function(){if(typeof s!="undefined"){e.cbconfirm(s,{buttonNo:false})}})};h.toggleHandler=function(e){e.preventDefault();s.call(this,h)};h.toggleSelectHandler=function(){s.call(this,h)};h.moreHandler=function(t){t.preventDefault();var a=e(this);if(a.hasClass("streamRequesting")){return}var i="more";if(a.hasClass("streamUpdate")){i="update"}var n=l.call(a.closest(".streamContainer"),h);if(!n.length){return}var s=l.call(n.find(".streamItems"),h);var c={};var m=null;var y=null;if(i=="update"){if(h.settings.direction=="up"){m=l.call(n.find(".streamItem[data-cbactivity-timestamp]:not(.streamItemPinned):last"),h)}else{m=l.call(n.find(".streamItem[data-cbactivity-timestamp]:not(.streamItemPinned):first"),h)}var I=Date.now?Date.now():+new Date;if(m.length){var C=m.data("cbactivity-timestamp");if(C){I=C}}c.id=I;y=a.data("cbactivity-update-url")}else{y=a.data("cbactivity-more-url")}if(!y){y=a.attr("href")}if(!y){return}e.ajax({url:y,type:"GET",data:c,dataType:"html",beforeSend:function(e,t,l){a.addClass("streamRequesting");if(i=="update"){h.element.triggerHandler("cbactivity.update.send",[h,a,n,e,t,l])}else{a.addClass("disabled").prop("disabled",true).html('<span class="streamIconMoreLoading fa fa-spinner fa-pulse"></span>');h.element.triggerHandler("cbactivity.more.send",[h,a,n,e,t,l])}}}).fail(function(e,t,l){a.removeClass("streamRequesting");if(i=="update"){h.element.triggerHandler("cbactivity.update.error",[h,a,n,e,t,l])}else{a.remove();h.element.triggerHandler("cbactivity.more.error",[h,a,n,e,t,l])}}).done(function(t,c,y){a.removeClass("streamRequesting");if(i=="more"){a.remove()}if(t){var I=e(t).hide();I.find(".streamItems > .streamItem").each(function(){if(l.call(n.find('.streamItem[data-cbactivity-id="'+e(this).data("cbactivity-id")+'"]'),h).length){e(this).remove()}});var C=o.call(I,h);if(h.settings.direction=="up"){if(i=="update"){if(m.length){I.insertAfter(m)}else{s.append(I)}}else{s.prepend(I);l.call(n.find(".streamMore"),h).insertBefore(s)}}else{if(i=="update"){if(m.length){I.insertBefore(m)}else{s.prepend(I)}}else{s.append(I);l.call(n.find(".streamMore"),h).insertAfter(s)}}d.call(I,h,C);I.fadeIn("slow")}if(i=="update"){h.element.triggerHandler("cbactivity.update.success",[h,a,n,I,t,c,y])}else{h.element.triggerHandler("cbactivity.more.success",[h,a,n,I,t,c,y])}if(t){r.call(I,h,true);if(i=="update"){if(h.settings.autoUpdate){if(!f){v()}else{u=0}}}else{l.call(h.element.find(".streamMore"),h).off("click",h.moreHandler).on("click",h.moreHandler);if(h.settings.autoLoad&&h.settings.direction!="up"){if(!p){b()}else{g=0}}}}})};h.cbselectFormat=function(t){var a=e(t.element).data("cbactivity-option-icon");if(typeof a!="undefined"){return e('<span><span class="cb_template streamSelectOptionIcon">'+a+"</span>"+t.text+"</span>")}else{return t.text}};h.modalHandler=function(t,a){t.preventDefault();var i=e(this);if(i.hasClass("streamRequesting")){return false}var l=i.data("cbactivity-modal-url");if(!l){l=i.attr("href")}if(!l){return false}i.addClass("streamRequesting");var n=null;a.tooltip.qtip("api").set("content.text",function(t,a){if(n==null){n=e.ajax({url:l,type:"GET",dataType:"html",beforeSend:function(e,t,a){h.element.triggerHandler("cbactivity.modal.send",[h,i,e,t,a])}}).fail(function(e,t,l){i.removeClass("streamRequesting");if(!a.destroyed){a.hide()}h.element.triggerHandler("cbactivity.modal.error",[h,i,e,t,l])}).done(function(t,l,n){i.removeClass("streamRequesting");if(a.destroyed){return}a.elements.tooltip.removeClass("streamModalContainerLoad streamModalContainerLoading");var s=null;if(t){s=e(t);var c=o.call(s,h);a.set("content.text",s);d.call(a.elements.content,h,c)}else{a.hide()}h.element.triggerHandler("cbactivity.modal.success",[h,i,s,t,l,n]);if(t){r.call(a.elements.content,h,true)}})}return'<div class="streamModalLoading text-center"><span class="fa fa-spinner fa-pulse fa-3x"></span></div>'});h.element.triggerHandler("cbactivity.modal",[h,i,a,n,t]);return n};h.cbselectBeforeHandler=function(e,t){if(t.element.val()>0){var a=t.element.data("cbactivity-toggle-target");if(typeof a=="undefined"){return}var i=n.call(t.element,h);if(!i.length){return}var r=t.element.find(":selected");var s=r.data("cbactivity-toggle-placeholder");var c=l.call(i.find(a).find(".streamInputSelectToggleLabel"),h);if(c.length){c.html(r.text())}if(typeof s!="undefined"){var o=l.call(i.find(a).find(".streamInputSelectTogglePlaceholder"),h);if(c.length){o.attr("placeholder",s)}}}};h.cbselectAfterHandler=function(e,t){var a=t.element.data("cbactivity-toggle-icon");if(typeof a=="undefined"){return}t.container.find(".select2-selection").addClass(a)};h.element.on("remove destroy.cbactivity",function(){h.element.cbactivity("destroy")});h.element.on("rebind.cbactivity",function(){h.element.cbactivity("rebind")});h.element.on("modified.cbactivity",function(e,t,a,i){if(t!=a){h.element.cbactivity("rebind")}});h.element.on("cloned.cbactivity",function(){i.call(this,h);e(this).cbactivity(h.options)});h.element.triggerHandler("cbactivity.init.after",[h]);h.element.data("cbactivity",h);t.push(h);r.call(m,h,true);if(h.settings.autoUpdate&&!f){v()}if(h.settings.autoLoad&&h.settings.direction!="up"&&!p){b()}})},rebind:function(){var t=e(this).data("cbactivity");if(!t){return this}t.element.cbactivity("destroy");t.element.cbactivity(t.options);return this},destroy:function(){var a=e(this).data("cbactivity");if(!a){return this}e.each(t,function(e,i){if(i.element==a.element){t.splice(e,1);return false}return true});i.call(a.element,a);a.element.triggerHandler("cbactivity.destroyed",[a]);return this},instances:function(){return t}};function i(t){var a=this.jquery?this:e(this);a.off("destroy.cbactivity");a.off("rebind.cbactivity");a.off("modified.cbactivity");a.off("cloned.cbactivity");a.removeData("cbactivity");e(document).off("click.cbactivity",t.actinHandler);l.call(a.find(".streamItemNewCancel"),t).off("click",t.cancelNewHandler);l.call(a.find(".streamItemForm"),t).off("submit",t.saveHandler);l.call(a.find(".streamItemActionResponsesClose"),t).off("click",t.closeActionsHandler);l.call(a.find(".streamItemActionResponsesRevert"),t).off("click",t.revertActionsHandler);l.call(a.find(".streamItemActionResponseClose"),t).off("click",t.closeActionHandler);l.call(a.find(".streamItemNew .streamInputMessage.streamInputMessageCollapse"),t).off("click",t.displayNewHandler);l.call(a.find(".streamInputMessage[data-cbactivity-input-limit]"),t).off("keyup input change",t.messageLimitHandler);l.call(a.find(".streamItemScrollLeft"),t).off("click",t.scrollerLeftHandler);l.call(a.find(".streamItemScrollRight"),t).off("click",t.scrollerRightandler);l.call(a.find(".streamFindLocation"),t).off("click",t.locationHandler);l.call(a.find(".streamToggle"),t).off("click",t.toggleHandler);l.call(a.find("select.streamInputSelect"),t).off("change",t.toggleSelectHandler);l.call(a.find(".streamMore,.streamUpdate"),t).off("click",t.moreHandler);l.call(a.find(".streamModal"),t).off("cbtooltip.render",t.modalHandler);l.call(a.find(".cbMoreLess"),t).cbmoreless("destroy");l.call(a.find(".cbRepeat"),t).cbrepeat("destroy");l.call(a.find("select.streamInputSelect"),t).cbselect("destroy");l.call(a.find(".streamInputAutosize"),t).trigger("autosize.destroy");l.call(a.find(".streamItem"),t).each(function(){var t=e(this).data("cbactivity-active-classes");var a=e(this).data("cbactivity-inactive-classes");if(typeof t!="undefined"){e(this).removeClass(t)}if(typeof a!="undefined"){e(this).addClass(a)}})}function l(t){var a=this.jquery?this:e(this);return a.filter(function(){return e(this).closest(".streamContainer").is(t.element)||e(this).is(t.element)})}function n(t){var a=this.jquery?this:e(this);var i=l.call(a.closest(".streamItem"),t);var n=a.data("cbactivity-container");if(typeof n!="undefined"){if(n=="self"){i=a}else if(n=="items"){i=a.closest(".streamItems")}else if(n=="item"){i=a.closest(".streamItem")}else if(n=="stream"){i=a.closest(".streamContainer")}else{i=e(n);if(a.data("cbactivity-container-filter")!=false){i=l.call(i,t)}}}return i}function r(t,a){var i=this.jquery?this:e(this);if(a===true){l.call(i.find(".cbMoreLess"),t).cbmoreless();l.call(i.find(".cbRepeat"),t).cbrepeat();l.call(i.find("select.streamInputSelect"),t).off("cbselect.init.before",t.cbselectBeforeHandler).on("cbselect.init.before",t.cbselectBeforeHandler).off("cbselect.init.after",t.cbselectAfterHandler).on("cbselect.init.after",t.cbselectAfterHandler).cbselect({width:"auto",height:"auto",minimumResultsForSearch:Infinity,templateSelection:t.cbselectFormat,templateResult:t.cbselectFormat});l.call(i.find('.cbTooltip,[data-hascbtooltip="true"]'),t).cbtooltip();l.call(i.find(".streamItemNewCancel"),t).off("click",t.cancelNewHandler).on("click",t.cancelNewHandler);l.call(i.find(".streamItemForm"),t).off("submit",t.saveHandler).on("submit",t.saveHandler);l.call(i.find(".streamItemActionResponsesClose"),t).off("click",t.closeActionsHandler).on("click",t.closeActionsHandler);l.call(i.find(".streamItemActionResponsesRevert"),t).off("click",t.revertActionsHandler).on("click",t.revertActionsHandler);l.call(i.find(".streamItemActionResponseClose"),t).off("click",t.closeActionHandler).on("click",t.closeActionHandler);l.call(i.find(".streamItemNew .streamInputMessage.streamInputMessageCollapse"),t).off("click",t.displayNewHandler).on("click",t.displayNewHandler);l.call(i.find(".streamInputMessage[data-cbactivity-input-limit]"),t).off("keyup input change",t.messageLimitHandler).on("keyup input change",t.messageLimitHandler);l.call(i.find(".streamItemScrollLeft"),t).off("click",t.scrollerLeftHandler).on("click",t.scrollerLeftHandler);l.call(i.find(".streamItemScrollRight"),t).off("click",t.scrollerRightandler).on("click",t.scrollerRightandler);l.call(i.find(".streamFindLocation"),t).off("click",t.locationHandler).on("click",t.locationHandler);l.call(i.find(".streamToggle"),t).off("click",t.toggleHandler).on("click",t.toggleHandler);l.call(i.find("select.streamInputSelect"),t).off("change",t.toggleSelectHandler).on("change",t.toggleSelectHandler);l.call(i.find(".streamMore,.streamUpdate"),t).off("click",t.moreHandler).on("click",t.moreHandler);l.call(i.find(".streamModal"),t).off("cbtooltip.render",t.modalHandler).on("cbtooltip.render",t.modalHandler)}l.call(i.find(".streamInputAutosize:visible"),t).trigger("autosize.destroy").autosize({append:"",resizeDelay:0,placeholder:false});t.element.triggerHandler("cbactivity.bind",[t,i,a])}function s(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}var r=typeof a.data("cbselect")!="undefined";var s=a.data("cbactivity-toggle-target");var c=a.data("cbactivity-toggle-active-classes");var o=a.data("cbactivity-toggle-inactive-classes");var d=a.data("cbactivity-toggle-open")!=false;var f=a.data("cbactivity-toggle-close")!=false;var m=a.data("cbactivity-toggle-filter")!=false;var u=false;if(r||a.is("select")){var v=a.val();if(r){v=a.cbselect("get")}u=!v||v==0||v==""}else{if(a.hasClass("streamToggleOpen")){u=true}}if(u){if(f){a.removeClass("streamToggleOpen");if(r){a.cbselect("container").removeClass("streamToggleOpen")}if(typeof c!="undefined"){a.removeClass(c);if(r){a.cbselect("container").removeClass(c)}}if(typeof o!="undefined"){a.addClass(o);if(r){a.cbselect("container").addClass(o)}}if(typeof s!="undefined"){if(m){l.call(i.find(s),t).addClass("hidden");l.call(i.find(s).find("input,textarea,select"),t).prop("disabled",true)}else{i.find(s).addClass("hidden");i.find(s).find("input,textarea,select").prop("disabled",true)}}}}else{if(d){a.addClass("streamToggleOpen");if(r){a.cbselect("container").addClass("streamToggleOpen")}if(typeof c!="undefined"){a.addClass(c);if(r){a.cbselect("container").addClass(c)}}if(typeof o!="undefined"){a.removeClass(o);if(r){a.cbselect("container").removeClass(o)}}if(typeof s!="undefined"){if(m){l.call(i.find(s),t).removeClass("hidden");l.call(i.find(s).find("input,textarea,select"),t).prop("disabled",false)}else{i.find(s).removeClass("hidden");i.find(s).find("input,textarea,select").prop("disabled",false)}}}}if(a.hasClass("streamInputSelect")&&typeof s!="undefined"){var p=a.find(":selected");var h=p.data("cbactivity-toggle-placeholder");var g=l.call(i.find(s).find(".streamInputSelectToggleLabel"),t);if(g.length){g.html(p.text())}if(typeof h!="undefined"){var b=l.call(i.find(s).find(".streamInputSelectTogglePlaceholder"),t);if(g.length){b.attr("placeholder",h)}}}if(a.hasClass("streamInputCheckbox")){var y=a.find('input[type="checkbox"]');if(u){y.prop("checked",false)}else{y.prop("checked",true)}}}function c(t){var a=this.jquery?this:e(this);var i=n.call(a,t);if(!i.length){return}l.call(i.find(".streamItemActionResponse"),t).remove();var c=l.call(i.find(".streamInputMessage"),t);if(c.hasClass("streamInputMessageCollapse")){l.call(i.find(".streamItemDisplay"),t).addClass("hidden");c.attr("rows",1)}l.call(i.find("input,textarea,select"),t).each(function(){var t=e(this).attr("type");if(t=="checkbox"||t=="radio"){if(t=="radio"&&e(this).siblings('input[type="radio"]').length+1==2&&e(this).val()==0){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}else{if(e(this).is("select")){var a="";if(!e(this).children('option[value=""]:first').length&&!e(this).hasClass("streamInputTags")){a=e(this).children('option[value!=""]:first').val()}if(typeof e(this).data("cbselect")!="undefined"){e(this).cbselect("set",a)}else{e(this).val(a)}}else{e(this).val("")}}e(this).trigger("change")});l.call(i.find(".streamToggleOpen"),t).each(function(){s.call(this,t)});l.call(i.find(".cbRepeat"),t).cbrepeat("reset");t.element.triggerHandler("cbactivity.new.cancel",[t,a,i]);r.call(i,t)}function o(t){var a=this.jquery?this:e(this);var i=a.find(".streamItemHeaders");if(!i.length){i=a.filter(".streamItemHeaders")}if(!i.length){return[]}var l=e("head");var n=[];var r=[];l.find("link").each(function(){var t=e(this).attr("href");if(typeof t!="undefined"){n.push(t)}});l.find("script").each(function(){var t=e(this).attr("src");if(typeof t!="undefined"){r.push(t)}});i.children("link").each(function(){var t=e(this).attr("href");if(typeof t!="undefined"&&n.indexOf(t)!==-1){e(this).remove()}});var s=[];i.children("script").each(function(){var t=e(this).attr("src");if(typeof t=="undefined"){s.push(this)}else{if(r.indexOf(t)===-1){s.push(this)}}e(this).remove()});return s}function d(t,a){if(!a.length){return}var i=this.jquery?this:e(this);var l=e('<div class="streamItemHeadersScripts" style="position: absolute; display: none; height: 0; width: 0; z-index: -999;" />');var n=function(t){var i=t+1;var r=e(this).attr("src");if(r){e.ajax({url:r,dataType:"script"}).always(function(){l.append('<script type="text/javascript" src="'+r+'"><\/script>');if(typeof a[i]!="undefined"){n.call(a[i],i)}})}else{l.append('<script type="text/javascript">'+e(this).text()+"<\/script>");if(typeof a[i]!="undefined"){n.call(a[i],i)}}};n.call(a[0],0);var r=i.find(".streamItemHeaders");if(!r.length){r=i.filter(".streamItemHeaders")}r.append(l)}var f=false;var m=60;var u=0;function v(){if(f){return}f=true;var a=function(){if(!t.length){return}if(!document.hidden){e.each(t,function(e,t){if(!t.settings.autoUpdate||!t.element.length){return false}var a=l.call(t.element.find(".streamUpdate,.streamRefresh"),t);if(!a.length){return false}a.click()});u++}if(u<m){setTimeout(a,6e4)}else{f=false}};if(u<m){setTimeout(a,6e4)}}var p=false;var h=150;var g=0;function b(){if(p){return}p=true;var a=function(){if(!t.length){return}if(!document.hidden){e.each(t,function(t,a){if(!a.settings.autoLoad||a.settings.direction=="up"||!a.element.length){return false}var i=l.call(a.element.find(".streamMore"),a);if(!i.length){return false}var n=e(window).scrollTop();var r=n+e(window).height();var s=l.call(a.element.find(".streamItem[data-cbactivity-id]"),a);var c=s.eq(-Math.round(s.length/3));var o=null;var d=null;if(c.length){o=c.offset().top;d=o+c.height()}else{o=i.offset().top;d=o+i.height()}if(n>=o||r>=d){i.click()}});g++}if(g<h){setTimeout(a,2e3)}else{p=false}};if(g<h){setTimeout(a,5e3)}}e.fn.cbactivity=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return a.init.apply(this,arguments)}return this};e.fn.cbactivity.defaults={init:true,useData:true,direction:"down",autoUpdate:false,autoLoad:false}})(jQuery);