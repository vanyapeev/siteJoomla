(function(e){var t=[];var n={init:function(n){return this.each(function(){var a=this;var s=e(a).data("cbprivacy");if(s){return}s={};s.options=n;s.defaults=e.fn.cbprivacy.defaults;s.settings=e.extend(true,{},s.defaults,s.options);s.element=e(a);if(s.settings.useData){e.each(s.defaults,function(e,t){if(e!="init"&&e!="useData"){var n=s.element.data("cbprivacy"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof n!="undefined"){s.settings[e]=n}else{n=s.element.data("cbprivacy"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof n!="undefined"){s.settings[e]=n}}}})}s.element.trigger("cbprivacy.init.before",[s]);if(!s.settings.init){return}s.dropdownTemplate=function(t){if(typeof t.id!="undefined"){var n=e(t.element).data("cbprivacy-option-icon");if(typeof n!="undefined"){return e('<span><span class="cb_template cbPrivacySelectOptionIcon">'+n+'</span><span class="cbPrivacySelectOptionText">'+t.text+"</span></span>")}else{return e('<span><span class="cb_template cbPrivacySelectOptionNoIcon"></span><span class="cbPrivacySelectOptionText">'+t.text+"</span></span>")}}else{return t.text}};s.selectionTemplate=function(t){if(typeof t.id!="undefined"){var n=e(t.element).data("cbprivacy-option-icon");if(s.settings.layout=="tags"){return t.text}else if(s.settings.layout=="icon"){if(typeof n!="undefined"){return e('<span><span class="cb_template cbPrivacySelectOptionIcon">'+n+"</span></span>")}else{return e('<span><span class="cb_template cbPrivacySelectOptionNoIcon"><span class="cbPrivacySelectOptionIconCustom fa fa-cog"></span></span></span>')}}else{var c=s.element.cbselect("get");if(c&&c.length>1){return e('<span><span class="cb_template cbPrivacySelectOptionIcon">'+n+'</span><span class="cbPrivacySelectOptionText">'+s.settings.custom+'</span><span class="cbPrivacySelectOptionIconCaret fa fa-caret-down"></span></span>')}else{if(typeof n!="undefined"){return e('<span><span class="cb_template cbPrivacySelectOptionIcon">'+n+'</span><span class="cbPrivacySelectOptionText">'+t.text+'</span><span class="cbPrivacySelectOptionIconCaret fa fa-caret-down"></span></span>')}else{return e('<span><span class="cb_template cbPrivacySelectOptionNoIcon"><span class="cbPrivacySelectOptionIconCustom fa fa-cog"></span></span><span class="cbPrivacySelectOptionText">'+t.text+'</span><span class="cbPrivacySelectOptionIconCaret fa fa-caret-down"></span></span>')}}}}else{return t.text}};s.selectingHandler=function(t,n,c){var a=s.element.cbselect("get");var i=[];if(c==0){s.element.cbselect("set","0");s.element.cbselect("close")}else if(c==1){s.element.cbselect("set","1");s.element.cbselect("close")}else if(c==99){s.element.cbselect("set","99");s.element.cbselect("close")}else if(c==2){i=["0","1","99"];e.each(a,function(e,t){if(t.indexOf("CONN-")>-1){i.push(t)}});if(i.length){s.element.cbselect("unset",i);s.element.cbselect("close")}}else if(c==3){e.each(a,function(e,t){if(t.indexOf("CONN-")>-1){i.push(t)}});if(i.length){s.element.cbselect("unset",i);s.element.cbselect("close")}}else{if(a.indexOf("0")>-1){s.element.cbselect("unset","0")}else if(a.indexOf("1")>-1){s.element.cbselect("unset","1")}else if(a.indexOf("99")>-1){s.element.cbselect("unset","99")}else if(c.indexOf("CONN-")>-1){if(a.indexOf("2")>-1){s.element.cbselect("unset","2")}if(a.indexOf("3")>-1){s.element.cbselect("unset","3")}}}};s.ajaxHandler=function(){if(!s.settings.ajax||s.element.hasClass("privacySaving")){return}var t=s.element.cbselect("get");if(t==null||t.length==0){return}if(e.isArray(t)&&e.isArray(s.selected)&&t.join(",")==s.selected.join(",")){return}s.selected=t;var n=s.element.attr("name");var c={};c[n]=t;e.ajax({url:s.settings.ajax,type:"POST",data:c,dataType:"html",beforeSend:function(e,t,n){s.element.addClass("privacySaving");s.element.prop("disabled",true);s.element.cbselect("container").addClass("privacySaving");s.element.triggerHandler("cbprivacy.ajax.send",[s,e,t,n])}}).fail(function(e,t,n){s.element.triggerHandler("cbprivacy.ajax.error",[s,e,t,n])}).done(function(e,t,n){s.element.removeClass("privacySaving");s.element.prop("disabled",false);s.element.cbselect("container").removeClass("privacySaving");s.element.triggerHandler("cbprivacy.ajax.success",[s,e,t,n])})};s.changeHandler=function(){var e=s.element.cbselect("get");if(e==null||e.length==0){s.element.cbselect("set",s.element.children('option[value!=""]:first').val())}};s.cbselect=s.element.cbselect({width:"auto",closeOnSelect:false,minimumResultsForSearch:Infinity,templateSelection:s.selectionTemplate,templateResult:s.dropdownTemplate});s.element.on("cbselect.selecting",s.selectingHandler);if(s.settings.ajax){s.element.on("cbselect.close",s.ajaxHandler)}s.element.on("change",s.changeHandler).change();s.selected=s.element.cbselect("get");s.element.on("remove destroy.cbprivacy",function(){s.element.cbprivacy("destroy")});s.element.on("rebind.cbprivacy",function(){s.element.cbprivacy("rebind")});s.element.on("modified.cbprivacy",function(e,t,n,c){if(n!=c){s.element.cbprivacy("rebind")}});s.element.on("cloned.cbprivacy",function(t,n){c.call(this,s);e(this).cbprivacy(s.options)});s.element.trigger("cbprivacy.init.after",[s]);s.element.data("cbprivacy",s);t.push(s)})},rebind:function(){var t=e(this).data("cbprivacy");if(!t){return this}t.element.cbprivacy("destroy");t.element.cbprivacy(t.options);return this},destroy:function(){var n=e(this).data("cbprivacy");if(!n){return false}e.each(t,function(e,c){if(c.element==n.element){t.splice(e,1);return false}return true});c.call(n.element,n);n.element.trigger("cbprivacy.destroyed",[n]);return true},instances:function(){return t}};function c(t){var n=this.jquery?this:e(this);n.off("destroy.cbprivacy");n.off("rebind.cbprivacy");n.off("cloned.cbprivacy");n.off("modified.cbprivacy");n.on("cbselect.selecting",t.selectingHandler);if(t.settings.ajax){n.on("cbselect.close",t.ajaxHandler)}n.on("change",t.changeHandler);n.cbselect("destroy");n.removeData("cbprivacy")}e.fn.cbprivacy=function(t){if(!e.fn.cbselect){return this}if(n[t]){return n[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return n.init.apply(this,arguments)}return this};e.fn.cbprivacy.defaults={init:true,useData:true,layout:"tags",custom:"Custom",ajax:null}})(jQuery);