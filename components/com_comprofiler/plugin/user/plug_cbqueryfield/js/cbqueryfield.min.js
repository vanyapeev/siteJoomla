!function(e){function t(t){var n=this.jquery?this:e(this);n.off("destroy.cbqueryfield"),n.off("rebind.cbqueryfield"),n.off("cloned.cbqueryfield"),n.off("modified.cbqueryfield"),n.removeData("cbqueryfield"),t.timer&&clearTimeout(t.timer),e(t.settings.selectors).each(function(){i.call(this).off("keyup change",t.changeHandler)}),e.each(r,function(e,t){return t.element==n?(r.splice(e,1),!1):!0})}function i(){var t=this.jquery?this:e(this),i=null;return t.is("input")||t.is("select")||t.is("textarea")?i=t:(i=t.find("input,select,textarea").first(),(i.is(":checkbox")||i.is(":radio"))&&(i=t.find('input[name="'+i.attr("name")+'"]'))),i}function n(){var t=this.jquery?this:e(this),i=null;return(t.is("input")||t.is("select")||t.is("textarea"))&&(t.is('input[type="checkbox"]')||t.is('input[type="radio"]')?(i=[],t.each(function(){e(this).is(":checked")&&i.push(e(this).val())})):t.is("select[multiple]")?(i=t.val(),i&&!e.isArray(i)&&(i=i.split(","))):i=t.val()),i}var r=[],s={init:function(s){return this.each(function(){var a=this,l=e(a).data("cbqueryfield");if(!l&&(l={},l.options=s,l.defaults=e.fn.cbqueryfield.defaults,l.settings=e.extend(!0,{},l.defaults,l.options),l.element=e(a),l.settings.useData&&e.each(l.defaults,function(e){if("init"!=e&&"useData"!=e){var t=l.element.data("cbqueryfield"+e.charAt(0).toUpperCase()+e.slice(1));"undefined"!=typeof t?l.settings[e]=t:(t=l.element.data("cbqueryfield"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()),"undefined"!=typeof t&&(l.settings[e]=t))}}),(l.settings.selectors||e(l.settings.selectors).length)&&(l.element.triggerHandler("cbqueryfield.init.before",[l]),l.settings.init))){(null===l.settings.post||"object"!=typeof l.settings.post&&!e.isArray(l.settings.post))&&(l.settings.post={}),l.target=i.call(l.element),l.timer=null;var c={};l.changeHandler=function(t){if("undefined"!=typeof t.data.queryUpdateTarget){var i=e(this).attr("name"),r=n.call(t.data.queryUpdateTarget);if(i.length){var s=l.target.attr("name"),a=n.call(l.target),u=l.settings.post;u[i]=r,s.length&&(u[s]=a);var f=400;"keyup"==t.type&&(f=800),l.timer&&clearTimeout(l.timer),l.timer=setTimeout(function(){if("undefined"!=typeof c[i]){var t=e.isArray(c[i])?c[i].toString():c[i],n=e.isArray(r)?r.toString():r;if(t===n)return}c[i]=r,e.ajax({url:l.settings.url,type:"POST",dataType:"html",cache:!1,data:u,beforeSend:function(e,t,i){l.element.find(".cbUpdateOptions").remove(),l.target.after('<span class="cbFieldIcons cbUpdateOptions"><span class="cbSpinner fa fa-spinner fa-spin-fast"></span></span>'),l.element.triggerHandler("cbqueryfield.edit.send",[l,e,t,i])},error:function(e,t,i){l.element.find(".cbUpdateOptions").remove(),l.element.triggerHandler("cbqueryfield.edit.error",[l,e,t,i])},success:function(t,i,n){l.element.find(".cbUpdateOptions").remove();var r=e("<div />").html(t);l.target.is("select")&&l.target.empty().append(r.find("select:first").children()),l.element.triggerHandler("cbqueryfield.edit.success",[l,t,i,n])}})},f)}}},e(l.settings.selectors).each(function(){var e=i.call(this);e.on("keyup change",{queryUpdateTarget:e},l.changeHandler)}),l.element.on("remove destroy.cbqueryfield",function(){l.element.cbqueryfield("destroy")}),l.element.on("rebind.cbqueryfield",function(){l.element.cbqueryfield("rebind")}),l.element.on("modified.cbqueryfield",function(e,t,i){t!=i&&l.element.cbqueryfield("rebind")}),l.element.on("cloned.cbqueryfield",function(){t.call(this,l),e(this).cbqueryfield(l.options)}),l.element.triggerHandler("cbqueryfield.init.after",[l]),l.element.data("cbqueryfield",l),r.push(l)}})},rebind:function(){var t=e(this).data("cbqueryfield");return t?(t.element.cbqueryfield("destroy"),t.element.cbqueryfield(t.options),this):this},destroy:function(){var i=e(this).data("cbqueryfield");return i?(t.call(i.element,i),i.element.triggerHandler("cbqueryfield.destroyed",[i]),!0):!1},instances:function(){return r}};e.fn.cbqueryfield=function(e){return s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?this:s.init.apply(this,arguments)},e.cbqueryfield=function(e){return"instances"==e?r:this},e.fn.cbqueryfield.defaults={init:!0,useData:!1,selectors:null,url:null,post:null}}(jQuery);