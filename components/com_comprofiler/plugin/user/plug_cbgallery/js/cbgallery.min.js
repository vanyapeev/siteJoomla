(function(e){var l=[];var a={init:function(a){return this.each(function(){var r=this;var i=e(r).data("cbgallery");if(i){return}i={};i.options=a;i.defaults=e.fn.cbgallery.defaults;i.settings=e.extend(true,{},i.defaults,i.options);i.element=e(r);if(i.settings.useData){e.each(i.defaults,function(e,l){if(e!="init"&&e!="useData"){var a=i.element.data("cbgallery"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof a!="undefined"){i.settings[e]=a}else{a=i.element.data("cbgallery"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof a!="undefined"){i.settings[e]=a}}}})}i.element.triggerHandler("cbgallery.init.before",[i]);if(!i.settings.init){return}if(i.settings.request===null||typeof i.settings.request!="object"&&!e.isArray(i.settings.request)){i.settings.request={}}e.ajaxPrefilter(function(e,l,a){e.async=true});if(i.settings.mode=="modal"){if(!i.settings.url){return}if(i.settings.previous){i.settings.request["previous"]=i.settings.previous}if(i.settings.next){i.settings.request["next"]=i.settings.next}i.navigationHandler=function(l){var a=i.element.data("cbtooltip");if(!a||e(l.target).is("input,textarea")){return}var t=0;if(l.type=="swipeleft"){t=37}else if(l.type=="swiperight"){t=39}else{t=l.which}switch(t){case 27:var n=a.tooltip.qtip("api").elements.content.find(".galleryModalClose");if(n.length){n.click()}else{return}break;case 37:var r=a.tooltip.qtip("api").elements.content.find(".galleryModalScrollLeftIcon");if(r.length){r.click()}else{return}break;case 39:var s=a.tooltip.qtip("api").elements.content.find(".galleryModalScrollRightIcon");if(s.length){s.click()}else{return}break;default:return}l.preventDefault()};i.actionHandler=function(l){l.preventDefault();if(i.element.hasClass("galleryRequesting")){return}var a=i.element.data("cbtooltip");if(!a){return}var t=e(l.target);var n=t.data("cbgallery-action-url");if(!n){n=t.attr("href")}if(!n){return}var r=t.data("cbgallery-confirm");var s=t.data("cbgallery-confirm-button");i.element.addClass("galleryRequesting");var d=function(){var l=null;a.tooltip.qtip("api").set("content.text",function(t,r){if(l==null){l=e.ajax({url:n,type:"GET",dataType:"html",cache:false,beforeSend:function(e,l,t){i.element.triggerHandler("cbgallery.modal.action.send",[i,a,e,l,t])}}).fail(function(e,l,t){i.element.removeClass("galleryRequesting");i.element.triggerHandler("cbgallery.modal.action.error",[i,a,e,l,t])}).done(function(l,n,s){i.element.removeClass("galleryRequesting");if(!r.destroyed){e(document).off("keydown.cbgallery",i.navigationHandler);e(document).off("click.cbgallery",".galleryModalAction",i.actionHandler);var d=null;try{d=JSON.parse(l)}catch(e){d={status:true,message:l}}var o=i.displayHandler(t,a);if(o){o.done(function(e,l,t){if(d&&typeof d.status!=="undefined"){if(d.status===true){if(typeof d.message!=="undefined"&&d.message){if(r.elements.content){r.elements.content.find(".galleryModalDisplay").prepend('<div class="galleryModalAlert alert alert-sm alert-success">'+d.message+"</div>")}}i.element.triggerHandler("cbgallery.modal.action.success",[i,a,d,l,t])}else if(d.status===false){if(typeof d.message!=="undefined"&&d.message){if(r.elements.content){r.elements.content.find(".galleryModalDisplay").prepend('<div class="galleryModalAlert alert alert-sm alert-danger">'+d.message+"</div>")}}i.element.triggerHandler("cbgallery.modal.action.failed",[i,a,d,l,t])}}})}}i.element.triggerHandler("cbgallery.modal.action.always",[i,a,l,n,s])})}return'<div class="galleryModalLoading text-center"><span class="fa fa-spinner fa-pulse fa-3x"></span></div>'})};if(r){e.cbconfirm(r,{buttonYes:s}).done(d).fail(function(){i.element.removeClass("galleryRequesting")})}else{d()}};i.closeHandler=function(){e(document).off("keydown.cbgallery",i.navigationHandler);e(document).off("click.cbgallery",".galleryModalAction",i.actionHandler);e("body").removeClass("galleryModalOpen");e("body > .galleryHeadersScripts").remove()};i.element.on("cbtooltip.hidden",i.closeHandler);i.moveHandler=function(e,l,a,t){if(t.elements.tooltip){t.elements.content.find(".galleryModalItem,.galleryModalLoading").css("line-height",t.elements.content.css("max-height"));t.elements.content.find(".galleryRotate90,.galleryRotate270").css("max-width",t.elements.content.css("max-height"))}};i.element.on("cbtooltip.move",i.moveHandler);i.displayHandler=function(l,a){if(i.element.hasClass("galleryRequesting")){return}i.element.addClass("galleryRequesting");if(i.settings.preload){var r=new Image;r.src=i.settings.preload}a.tooltip.qtip("api").set({"show.effect":false,"hide.effect":false});var s=null;a.tooltip.qtip("api").set("content.text",function(l,r){if(s==null){s=e.ajax({url:i.settings.url,type:"GET",dataType:"html",cache:false,data:i.settings.request,beforeSend:function(e,l,t){i.element.triggerHandler("cbgallery.modal.send",[i,a,e,l,t])}}).fail(function(e,l,t){i.element.removeClass("galleryRequesting");if(!r.destroyed){r.hide()}i.element.triggerHandler("cbgallery.modal.error",[i,a,e,l,t])}).done(function(l,s,d){i.element.removeClass("galleryRequesting");if(!r.destroyed){var o=e(l);var f=t.call(o,i);r.set("content.text",o.html());n.call(r.elements.content,i,f);if(r.elements.content){r.elements.content.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip();r.elements.content.find(".galleryModalScrollLeftIcon").on("click",function(){var l=e(this).data("cbgallery-previous");if(l){r.toggle(false);i.element.closest(".galleryContainer").siblings(l).find(".galleryModalToggle:first").click()}});r.elements.content.find(".galleryModalScrollRightIcon").on("click",function(){var l=e(this).data("cbgallery-next");if(l){r.toggle(false);i.element.closest(".galleryContainer").siblings(l).find(".galleryModalToggle:first").click()}});r.elements.content.find(".galleryModalDisplay").on("swipeleft swiperight",i.navigationHandler)}e(document).off("keydown.cbgallery").on("keydown.cbgallery",i.navigationHandler);e(document).off("click.cbgallery").on("click.cbgallery",".galleryModalAction",i.actionHandler);e("body").addClass("galleryModalOpen")}i.element.triggerHandler("cbgallery.modal.success",[i,a,l,s,d])})}return'<div class="galleryModalLoading text-center"><span class="fa fa-spinner fa-pulse fa-3x"></span></div>'});return s};i.element.on("cbtooltip.render",i.displayHandler)}else if(i.settings.mode=="share"){if(!i.settings.url){return}i.element.find(".galleryShareUpload").fileupload({url:i.settings.url,dataType:"html",sequentialUploads:true,replaceFileInput:false,dropZone:i.element.find(".galleryShareUploadDropZone"),pasteZone:e(document),processQueue:[{action:"clientSideResize",cbgallery:i}],add:function(l,a){if(i.settings.callback.upload.add){i.element.find(".galleryShareUploadProgress").removeClass("hidden")}e.each(a.files,function(e,l){l.error=null;l.context=null;if(i.settings.callback.upload.add){l.context=i.settings.callback.upload.add.call(i.element,i,a,l)}if(l.context){l.context.find(".galleryShareUploadProgressCancel").on("click",function(){a.abort();l.context.find(".progress-bar").css("width","100%").removeClass("progress-bar-striped active").addClass("progress-bar-warning");l.context.find(".galleryShareUploadProgressClear").removeClass("hidden");l.context.find(".galleryShareUploadProgressCancel").remove()});l.context.find(".galleryShareUploadProgressClear").on("click",function(){l.context.next(".galleryShareUploadProgressError").remove();l.context.remove();if(!i.element.find(".galleryShareUploadProgressRow").length){i.element.find(".galleryShareUploadProgress").addClass("hidden")}});l.context.appendTo(i.element.find(".galleryShareUploadProgressRows"))}i.element.triggerHandler("cbgallery.upload.add.file",[i,l,a])});if(typeof e.blueimp.fileupload.prototype.process!=="undefined"){a.process(function(){return i.element.find(".galleryShareUpload").fileupload("process",a)})}a.process().done(function(){a.submit()});e(this).val("");i.element.triggerHandler("cbgallery.upload.add",[i,a])},progress:function(e,l){var a=l.files[0].context;if(a){a.find(".progress-bar").css("width",parseInt(l.loaded/l.total*100,10)+"%")}i.element.triggerHandler("cbgallery.upload.progress",[i,a,l])},fail:function(e,l){var a=l.files[0].context;if(a){a.find(".progress-bar").css("width","100%").removeClass("progress-bar-striped active").addClass("progress-bar-danger");a.find(".galleryShareUploadProgressClear").removeClass("hidden");a.find(".galleryShareUploadProgressCancel").remove()}i.element.triggerHandler("cbgallery.upload.error",[i,a,l])},done:function(l,a){var r=null;try{r=JSON.parse(a.result)}catch(l){r={status:true,message:a.result}}var s=a.files[0].context;if(s){var d=s.find(".progress-bar");s.find(".galleryShareUploadProgressClear").removeClass("hidden");s.find(".galleryShareUploadProgressCancel").remove();d.css("width","100%").removeClass("progress-bar-striped active")}if(r&&typeof r.status!=="undefined"){if(r.status===true){if(s){d.addClass("progress-bar-success")}if(typeof r.message!=="undefined"&&r.message){var o=e(r.message).hide();var f=t.call(o,i);i.element.find(".galleryShareEdit").append(o);n.call(o,i,f);o.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip();if(s){s.fadeOut("slow",function(){s.find(".galleryShareUploadProgressClear").click()})}o.fadeIn("slow");var c=function(){var l=e(this).val();if(e.isArray(l)){l=l.join("|*|")}e(this).data("cbgallery-initial-value",l)};o.find("input,select,textarea").each(c);var g=function(e,l){l.element.on("cbgallery.save.success",g);l.element.on("cbgallery.delete.success",m);l.element.find("input,select,textarea").each(c);if(i.element.find(".galleryShareEdit .galleryEditChanged").length){i.element.find(".galleryShareEditConfirm").removeClass("hidden");i.element.find(".galleryShareEditDone").addClass("hidden")}else{i.element.find(".galleryShareEditConfirm").addClass("hidden");i.element.find(".galleryShareEditDone").removeClass("hidden")}i.element.find(".galleryShareEditBack").addClass("hidden")};var m=function(){if(i.element.find(".galleryShareEdit .galleryEditChanged").length){i.element.find(".galleryShareEditConfirm").removeClass("hidden");i.element.find(".galleryShareEditDone").addClass("hidden")}else{i.element.find(".galleryShareEditConfirm").addClass("hidden");i.element.find(".galleryShareEditDone").removeClass("hidden")}i.element.find(".galleryShareEditBack").addClass("hidden")};o.on("cbgallery.save.success",g);o.on("cbgallery.delete.success",m);i.element.find(".galleryShareEditConfirm").addClass("hidden");i.element.find(".galleryShareEditDone").removeClass("hidden");i.element.find(".galleryShareEditBack").addClass("hidden")}i.element.triggerHandler("cbgallery.upload.success",[i,s,a])}else if(r.status===false){if(s){d.addClass("progress-bar-danger");if(typeof r.message!=="undefined"&&r.message){if(i.settings.callback.upload.error){a.files[0].error=i.settings.callback.upload.error.call(i.element,i,r,s,a)}if(a.files[0].error){s.after(a.files[0].error)}}}i.element.triggerHandler("cbgallery.upload.failed",[i,s,a])}}i.element.triggerHandler("cbgallery.upload.always",[i,s,a])}});i.uploadChangeHandler=function(){var l=e(this).val();if(e.isArray(l)){l=l.join("|*|")}if(l===e(this).data("cbgallery-initial-value")){e(this).removeClass("galleryEditChanged")}else{e(this).addClass("galleryEditChanged")}if(i.element.find(".galleryShareEdit .galleryEditChanged").length){i.element.find(".galleryShareEditConfirm").removeClass("hidden");i.element.find(".galleryShareEditDone").addClass("hidden")}else{i.element.find(".galleryShareEditConfirm").addClass("hidden");i.element.find(".galleryShareEditDone").removeClass("hidden")}i.element.find(".galleryShareEditBack").addClass("hidden")};i.element.find(".galleryShareEdit").on("keyup change","input,select,textarea",i.uploadChangeHandler);i.dropZoneHandler=function(l){if(!e(l.target).is("input")){l.preventDefault();i.element.find(".galleryShareUpload").click()}};i.element.find(".galleryShareUploadDropZone").on("click",i.dropZoneHandler);i.linkSaveHandler=function(l){l.preventDefault();if(i.element.hasClass("galleryRequesting")){return}var a=e(this);var r=i.element.find(".galleryShareLink");if(r.val()){i.element.addClass("galleryRequesting");i.settings.request["value"]=r.val();e.ajax({url:i.settings.url,type:"POST",dataType:"html",cache:false,data:i.settings.request,beforeSend:function(e,l,t){r.prop("disabled",true);a.prop("disabled",true);i.element.find(".galleryShareLinkLoading").removeClass("hidden");i.element.find(".galleryShareLinkArea").removeClass("has-error");i.element.find(".galleryShareLinkError").remove();i.element.triggerHandler("cbgallery.link.send",[i,e,l,t])}}).fail(function(e,l,a){i.element.removeClass("galleryRequesting");i.element.find(".galleryShareLinkLoading").addClass("hidden");i.element.find(".galleryShareLinkArea").addClass("has-error");i.element.triggerHandler("cbgallery.link.error",[i,e,l,a])}).done(function(l,s,d){i.element.removeClass("galleryRequesting");var o=null;try{o=JSON.parse(l)}catch(e){o={status:true,message:l}}i.element.find(".galleryShareLinkLoading").addClass("hidden");r.prop("disabled",false);a.prop("disabled",false);if(o&&typeof o.status!=="undefined"){if(o.status===true){r.val("");if(typeof o.message!=="undefined"&&o.message){var f=e(o.message).hide();var c=t.call(f,i);i.element.find(".galleryShareEdit").append(f);n.call(f,i,c);f.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip();f.fadeIn("slow")}i.element.triggerHandler("cbgallery.link.success",[i,o,s,d])}else if(o.status===false){i.element.find(".galleryShareLinkArea").addClass("has-error");if(typeof o.message!=="undefined"&&o.message){var g=null;if(i.settings.callback.link.error){g=i.settings.callback.link.error.call(i.element,i,o,l)}if(g){i.element.find(".galleryShareLinkArea").append(g)}}i.element.triggerHandler("cbgallery.link.failed",[i,o,s,d])}}i.element.triggerHandler("cbgallery.link.always",[i,o,s,d])})}else{i.element.find(".galleryShareLinkArea").addClass("has-error")}};i.element.find(".galleryShareLinkSave").on("click",i.linkSaveHandler)}else if(i.settings.mode=="edit"){i.deleteHandler=function(l){l.preventDefault();if(i.element.hasClass("galleryRequesting")){return}var a=e(this).data("cbgallery-delete-url");if(!a){return false}e.cbconfirm(e(this).data("cbgallery-delete-message")).done(function(){i.element.addClass("galleryRequesting");e.ajax({url:a,type:"POST",dataType:"html",cache:false,beforeSend:function(e,l,a){if(i.element.hasClass("panel")){i.element.removeClass("panel-danger").addClass("panel-default")}i.element.find(".galleryEditError").remove();i.element.find(".galleryEditLoading").removeClass("hidden").css("line-height",i.element.outerHeight()+"px");i.element.triggerHandler("cbgallery.delete.send",[i,e,l,a])}}).fail(function(e,l,a){i.element.removeClass("galleryRequesting");i.element.find(".galleryEditLoading").addClass("hidden");if(i.element.hasClass("panel")){i.element.removeClass("panel-default").addClass("panel-danger")}i.element.triggerHandler("cbgallery.delete.error",[i,e,l,a])}).done(function(l,a,t){i.element.removeClass("galleryRequesting");var n=null;try{n=JSON.parse(l)}catch(e){n={status:true,message:l}}i.element.find(".galleryEditLoading").addClass("hidden");if(n&&typeof n.status!=="undefined"){if(n.status===true){var r=i.element.clone(true);i.element.fadeOut("slow",function(){e(this).remove();r.triggerHandler("cbgallery.delete.success",[i,n,a,t])})}else if(n.status===false){if(i.element.hasClass("panel")){i.element.removeClass("panel-default").addClass("panel-danger")}if(typeof n.message!=="undefined"&&n.message){var s=null;if(i.settings.callback.delete.error){s=i.settings.callback.delete.error.call(i.element,i,n,l,a,t)}if(s){i.element.prepend(s)}}i.element.triggerHandler("cbgallery.delete.failed",[i,n,a,t])}}i.element.triggerHandler("cbgallery.delete.always",[i,n,a,t])})});return false};i.element.find(".galleryEditDelete").on("click",i.deleteHandler);i.editHandler=function(l){l.preventDefault();if(i.element.hasClass("galleryRequesting")){return}i.element.addClass("galleryRequesting");i.element.find(".galleryEditForm").ajaxSubmit({type:"POST",dataType:"html",beforeSerialize:function(e,l){i.element.triggerHandler("cbgallery.save.serialize",[i,e,l])},beforeSubmit:function(e,l,a){var t=i.element.data("cbvalidate");if(t){if(!t.element.cbvalidate("validate")){return false}}if(i.element.hasClass("panel")){i.element.removeClass("panel-danger").addClass("panel-default")}i.element.find(".galleryEditError").remove();i.element.find(".galleryEditLoading").removeClass("hidden").css("line-height",i.element.outerHeight()+"px");i.element.triggerHandler("cbgallery.save.submit",[i,e,l,a])},error:function(e,l,a){i.element.removeClass("galleryRequesting");i.element.find(".galleryEditLoading").addClass("hidden");if(i.element.hasClass("panel")){i.element.removeClass("panel-default").addClass("panel-danger")}i.element.triggerHandler("cbgallery.save.error",[i,e,l,a])},success:function(l,a,r){i.element.removeClass("galleryRequesting");var s=null;try{s=JSON.parse(l)}catch(e){s={status:true,message:l}}i.element.find(".galleryEditLoading").addClass("hidden");if(s&&typeof s.status!=="undefined"){if(s.status===true){var d=e(l).hide();var o=t.call(d,i);var f=i.element.clone(true);i.element.replaceWith(d);n.call(d,i,o);d.find('.cbTooltip,[data-hascbtooltip="true"]').cbtooltip();d.fadeIn("slow");i.element=d;f.triggerHandler("cbgallery.save.success",[i,s,l,a,r])}else if(s.status===false){if(i.element.hasClass("panel")){i.element.removeClass("panel-default").addClass("panel-danger")}if(typeof s.message!=="undefined"&&s.message){var c=null;if(i.settings.callback.edit.error){c=i.settings.callback.edit.error.call(i.element,i,s,l,a,r)}if(c){i.element.prepend(c)}}i.element.triggerHandler("cbgallery.save.failed",[i,s,l,a,r])}}}});return false};i.element.find(".galleryEditForm").on("submit",i.editHandler)}i.element.on("remove destroy.cbgallery",function(){i.element.cbgallery("destroy")});i.element.on("rebind.cbgallery",function(){i.element.cbgallery("rebind")});i.element.on("modified.cbgallery",function(e,l,a,t){if(a!=t){i.element.cbgallery("destroy");i.element.cbgallery(i.options)}});i.element.on("cloned.cbgallery",function(l,a){e(this).off(".cbgallery");if(i.settings.mode=="modal"){e(document).off("keydown.cbgallery",i.navigationHandler);e(document).off("click.cbgallery",".galleryModalAction",i.actionHandler);e(this).off("cbtooltip.hidden",i.closeHandler);e(this).off("cbtooltip.move",i.moveHandler);e(this).off("cbtooltip.render",i.displayHandler)}else if(i.settings.mode=="share"){e(this).find(".galleryShareUpload").fileupload("destroy");e(this).find(".galleryShareEdit").off("keyup change","input,select,textarea",i.uploadChangeHandler);e(this).find(".galleryShareUploadDropZone").off("click",i.dropZoneHandler);e(this).find(".galleryShareLinkSave").off("click",i.linkSaveHandler)}else if(i.settings.mode=="edit"){e(this).find(".galleryEditDelete").off("click",i.deleteHandler);e(this).find(".galleryEditSave").off("click",i.editHandler)}e(this).removeData("cbgallery");e(this).cbgallery(i.options)});i.element.triggerHandler("cbgallery.init.after",[i]);i.element.data("cbgallery",i);l.push(i)})},rebind:function(){var l=e(this).data("cbgallery");if(!l){return this}l.element.cbgallery("destroy");l.element.cbgallery(l.options);return this},destroy:function(){var a=e(this).data("cbgallery");if(!a){return false}a.element.off(".cbgallery");e.each(l,function(e,t){if(t.element==a.element){l.splice(e,1);return false}return true});if(a.settings.mode=="modal"){e(document).off("keydown.cbgallery",a.navigationHandler);e(document).off("click.cbgallery",".galleryModalAction",a.actionHandler);a.element.off("cbtooltip.hidden",a.closeHandler);a.element.off("cbtooltip.move",a.moveHandler);a.element.off("cbtooltip.render",a.displayHandler)}else if(a.settings.mode=="share"){a.element.find(".galleryShareUpload").fileupload("destroy");a.element.find(".galleryShareEdit").off("keyup change","input,select,textarea",a.uploadChangeHandler);a.element.find(".galleryShareUploadDropZone").off("click",a.dropZoneHandler);a.element.find(".galleryShareLinkSave").off("click",a.linkSaveHandler)}else if(a.settings.mode=="edit"){a.element.find(".galleryEditDelete").off("click",a.deleteHandler);a.element.find(".galleryEditSave").off("click",a.editHandler)}a.element.removeData("cbgallery");a.element.triggerHandler("cbgallery.destroyed",[a]);return true},instances:function(){return l}};e.widget("blueimp.fileupload",e.blueimp.fileupload,{processActions:{clientSideResize:function(l,a){var t=this;var n=e.Deferred();var r=l.files[l.index];var i=a.cbgallery;if(!window.FileReader||!window.Blob||!i.settings.clientResize||!r.type.match(/image/)){n.resolveWith(t,[l])}else{var s=new FileReader;var d=i.settings.maxWidth;var o=i.settings.maxHeight;var f=i.settings.aspectRatio;s.mimeType=r.type;s.onload=function(e){var a=new Image;a.mimeType=this.mimeType;a.onload=function(e){var i=a.width;var s=a.height;var c=a.mimeType;var g=i;if(!d){d=g}var m=s;if(!o){o=m}var u=0;var p=0;if(!f){g=d;m=o}else if(f==1){if(g>d){m=m*(d/g);g=d}if(m>o){g=g*(o/m);m=o}}else if(f==2){if(d>o||o==d&&m>g){m=m*(d/g);g=d;p=o/2-m/2}else if(o>d||o==d&&g>m){g=g*(o/m);m=o;u=d/2-g/2}else if(g==m){g=d;m=o}}var y=null;if(m>g){y="portrait";if(m<=o){y="landscape"}}else if(g>m){y="landscape";if(g<=d){y="portrait"}}else{y="square"}if(i==g&&s==m&&f!=3){n.resolveWith(t,[l])}else{var h=document.createElement("canvas");if(f==2){h.width=d;h.height=o;if(y=="square"){u=0;p=0}}else{h.width=g;h.height=m}var v=h.getContext("2d");v.mozImageSmoothingEnabled=false;v.webkitImageSmoothingEnabled=false;v.msImageSmoothingEnabled=false;v.imageSmoothingEnabled=false;v.drawImage(a,u,p,g,m);var b=new XMLHttpRequest;b.open("GET",h.toDataURL(c),true);b.responseType="arraybuffer";b.onload=function(){if(this.response){var e=new Blob([this.response],{type:r.type});e.name=r.name;e.context=r.context;e.error=r.error;l.files[l.index]=e}n.resolveWith(t,[l])};b.onerror=function(){n.resolveWith(t,[l])};b.send()}};a.src=e.target.result};s.onerror=function(){n.resolveWith(t,[l])};s.readAsDataURL(r)}return n.promise()}}});function t(l){var a=this.jquery?this:e(this);var t=a.find(".galleryHeaders");if(!t.length){t=a.filter(".galleryHeaders")}if(!t.length){return[]}var n=e("head");var r=[];var i=[];if(l.settings.mode=="modal"){e("body > .galleryHeadersScripts").remove()}n.find("link").each(function(){var l=e(this).attr("href");if(typeof l!="undefined"){r.push(l)}});n.find("script").each(function(){var l=e(this).attr("src");if(typeof l!="undefined"){i.push(l)}});t.children("link").each(function(){var l=e(this).attr("href");if(typeof l!="undefined"&&r.indexOf(l)!==-1){e(this).remove()}});var s=[];t.children("script").each(function(){var l=e(this).attr("src");if(typeof l=="undefined"){s.push(this)}else{if(i.indexOf(l)===-1){s.push(this)}}e(this).remove()});return s}function n(l,a){if(!a.length){return}var t=this.jquery?this:e(this);var n=e('<div class="galleryHeadersScripts" style="position: absolute; display: none; height: 0; width: 0; z-index: -999;" />');var r=function(l){var t=l+1;var i=e(this).attr("src");if(i){e.ajax({url:i,dataType:"script"}).always(function(){n.append('<script type="text/javascript" src="'+i+'"><\/script>');if(typeof a[t]!="undefined"){r.call(a[t],t)}})}else{n.append('<script type="text/javascript">'+e(this).text()+"<\/script>");if(typeof a[t]!="undefined"){r.call(a[t],t)}}};r.call(a[0],0);if(l.settings.mode=="modal"){e("body").append(n)}else{var i=t.find(".galleryHeaders");if(!i.length){i=t.filter(".galleryHeaders")}i.append(n)}}e.fn.cbgallery=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return a.init.apply(this,arguments)}return this};e.fn.cbgallery.defaults={init:true,useData:true,mode:"modal",clientResize:true,maxWidth:0,maxHeight:0,aspectRatio:1,url:null,preload:null,previous:null,next:null,request:null,callback:{upload:{add:null,error:null},link:{error:null},delete:{error:null},edit:{error:null}}}})(jQuery);