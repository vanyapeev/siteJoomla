(function(t){var e=function(e,i){this.$element=t(e);if(!this.$element.is("input")){t.error("Combodate should be applied to INPUT element");return}this.options=t.extend({},t.fn.combodate.defaults,i,this.$element.data());this.init()};e.prototype={constructor:e,init:function(){this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]};this.$widget=t('<span class="combodate"></span>').html(this.getTemplate());this.initCombos();this.datetime=null;this.$widget.on("change","select",t.proxy(function(e){this.$element.val(this.getValue()).change();if(this.options.smartDays){if(t(e.target).is(".month")||t(e.target).is(".year")){this.fillCombo("day")}}},this));this.$widget.find("select").css("width","auto");this.$element.hide().after(this.$widget);this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var e=this.options.template;var i=this.$element.prop("disabled");var s=this.options.customClass;t.each(this.map,function(t,i){i=i[0];var s=new RegExp(i+"+"),o=i.length>1?i.substring(1,2):i;e=e.replace(s,"{"+o+"}")});e=e.replace(/ /g,"&nbsp;");t.each(this.map,function(t,o){o=o[0];var n=o.length>1?o.substring(1,2):o;e=e.replace("{"+n+"}",'<select class="'+t+" "+s+'"'+(i?' disabled="disabled"':"")+"></select>")});return e},initCombos:function(){for(var t in this.map){var e=this.$widget.find("."+t);this["$"+t]=e.length?e:null;this.fillCombo(t)}},fillCombo:function(t){var e=this["$"+t];if(!e){return}var i="fill"+t.charAt(0).toUpperCase()+t.slice(1);var s=this[i]();var o=e.val();e.empty();for(var n=0;n<s.length;n++){e.append('<option value="'+s[n][0]+'">'+s[n][1]+"</option>")}e.val(o)},fillCommon:function(t){var e=[],i;if(this.options.firstItem==="name"){if(moment.localeData){i=moment.localeData()._relativeTime}else{i=moment.relativeTime||moment.langData()._relativeTime}var s=typeof i[t]==="function"?i[t](1,true,t,false):i[t];s=s.split(" ").reverse()[0];e.push(["",s])}else if(this.options.firstItem==="empty"){e.push(["",""])}return e},fillDay:function(){var t=this.fillCommon("d"),e,i,s=this.options.template.indexOf("DD")!==-1,o=31;if(this.options.smartDays&&this.$month&&this.$year){var n=parseInt(this.$month.val(),10);var a=parseInt(this.$year.val(),10);if(!isNaN(n)&&!isNaN(a)){o=moment([a,n]).daysInMonth()}}for(i=1;i<=o;i++){e=s?this.leadZero(i):i;t.push([i,e])}return t},fillMonth:function(){var t=this.fillCommon("M"),e,i,s=this.options.template.indexOf("MMMMMM")!==-1,o=this.options.template.indexOf("MMMMM")!==-1,n=this.options.template.indexOf("MMMM")!==-1,a=this.options.template.indexOf("MMM")!==-1,r=this.options.template.indexOf("MM")!==-1;for(i=0;i<=11;i++){if(s){e=moment().date(1).month(i).format("MM - MMMM")}else if(o){e=moment().date(1).month(i).format("MM - MMM")}else if(n){e=moment().date(1).month(i).format("MMMM")}else if(a){e=moment().date(1).month(i).format("MMM")}else if(r){e=this.leadZero(i+1)}else{e=i+1}t.push([i,e])}return t},fillYear:function(){var t=[],e,i,s=this.options.template.indexOf("YYYY")!==-1;for(i=this.options.maxYear;i>=this.options.minYear;i--){e=s?i:(i+"").substring(2);t[this.options.yearDescending?"push":"unshift"]([i,e])}t=this.fillCommon("y").concat(t);return t},fillHour:function(){var t=this.fillCommon("h"),e,i,s=this.options.template.indexOf("h")!==-1,o=this.options.template.indexOf("H")!==-1,n=this.options.template.toLowerCase().indexOf("hh")!==-1,a=s?1:0,r=s?12:23;for(i=a;i<=r;i++){e=n?this.leadZero(i):i;t.push([i,e])}return t},fillMinute:function(){var t=this.fillCommon("m"),e,i,s=this.options.template.indexOf("mm")!==-1;for(i=0;i<=59;i+=this.options.minuteStep){e=s?this.leadZero(i):i;t.push([i,e])}return t},fillSecond:function(){var t=this.fillCommon("s"),e,i,s=this.options.template.indexOf("ss")!==-1;for(i=0;i<=59;i+=this.options.secondStep){e=s?this.leadZero(i):i;t.push([i,e])}return t},fillAmpm:function(){var t=this.options.template.indexOf("a")!==-1,e=this.options.template.indexOf("A")!==-1,i=[["am",t?"am":"AM"],["pm",t?"pm":"PM"]];return i},getValue:function(e){var i,s={},o=this,n=false;t.each(this.map,function(t,e){if(t==="ampm"){return}if(o["$"+t]){s[t]=parseInt(o["$"+t].val(),10)}else{var i;if(o.datetime){i=o.datetime[e[1]]()}else{i=t==="day"?1:0}s[t]=i}if(isNaN(s[t])){n=true;return false}});if(n){return""}if(this.$ampm){if(s.hour===12){s.hour=this.$ampm.val()==="am"?0:12}else{s.hour=this.$ampm.val()==="am"?s.hour:s.hour+12}}i=moment([s.year,s.month,s.day,s.hour,s.minute,s.second]);this.highlight(i);e=e===undefined?this.options.format:e;if(e===null){return i.isValid()?i:null}else{return i.isValid()?i.format(e):""}},setValue:function(e){if(!e){return}var i=typeof e==="string"?moment(e,this.options.format,true):moment(e),s=this,o={};function n(e,i){var s={};e.children("option").each(function(e,o){var n=t(o).attr("value"),a;if(n==="")return;a=Math.abs(n-i);if(typeof s.distance==="undefined"||a<s.distance){s={value:n,distance:a}}});return s.value}if(i.isValid()){t.each(this.map,function(t,e){if(t==="ampm"){return}o[t]=i[e[1]]()});if(this.$ampm){if(o.hour>=12){o.ampm="pm";if(o.hour>12){o.hour-=12}}else{o.ampm="am";if(o.hour===0){o.hour=12}}}t.each(o,function(t,e){if(s["$"+t]){if(t==="minute"&&s.options.minuteStep>1&&s.options.roundTime){e=n(s["$"+t],e)}if(t==="second"&&s.options.secondStep>1&&s.options.roundTime){e=n(s["$"+t],e)}s["$"+t].val(e)}});if(this.options.smartDays){this.fillCombo("day")}this.$element.val(i.format(this.options.format)).change();this.datetime=i}else{this.datetime=null}},highlight:function(t){if(!t.isValid()){if(this.options.errorClass){this.$widget.addClass(this.options.errorClass)}else{if(!this.borderColor){this.borderColor=this.$widget.find("select").css("border-color")}this.$widget.find("select").css("border-color","red")}}else{if(this.options.errorClass){this.$widget.removeClass(this.options.errorClass)}else{this.$widget.find("select").css("border-color",this.borderColor)}}},leadZero:function(t){return t<=9?"0"+t:t},destroy:function(){this.$widget.remove();this.$element.removeData("combodate").show()}};t.fn.combodate=function(i){var s,o=Array.apply(null,arguments);o.shift();if(i==="getValue"&&this.length&&(s=this.eq(0).data("combodate"))){return s.getValue.apply(s,o)}return this.each(function(){var s=t(this),n=s.data("combodate"),a=typeof i=="object"&&i;if(!n){s.data("combodate",n=new e(this,a))}if(typeof i=="string"&&typeof n[i]=="function"){n[i].apply(n,o)}})};t.fn.combodate.defaults={format:"DD-MM-YYYY HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:2015,yearDescending:true,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null,customClass:"",roundTime:true,smartDays:false}})(window.jQuery);