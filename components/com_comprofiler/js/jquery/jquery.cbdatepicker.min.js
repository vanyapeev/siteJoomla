(function(e){var t=[];var s={init:function(i){return this.each(function(){var n=this;var a=e(n).data("cbdatepicker");if(a){return}a={};a.options=typeof i!="undefined"?i:{};a.defaults=e.fn.cbdatepicker.defaults;a.settings=e.extend(true,{},a.defaults,a.options);a.strings=e.extend(true,{},e.datepicker.regional[""],a.settings.strings);a.element=e(n);if(a.settings.useData){e.each(a.defaults,function(e,t){if(e!="init"&&e!="useData"){var s=a.element.data("cbdatepicker"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof s!="undefined"){a.settings[e]=s}else{s=a.element.data("cbdatepicker"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof s!="undefined"){a.settings[e]=s}}}})}a.element.triggerHandler("cbdatepicker.init.before",[a]);if(!a.settings.init){return}var r=(new Date).getFullYear();if(a.settings.minYear){if(typeof a.settings.minYear=="string"){var l=a.settings.minYear.substr(0,1);var c=a.settings.minYear.substr(1);if(l=="+"){a.settings.minYear=r+parseInt(c)}else if(l=="-"){a.settings.minYear=r-parseInt(c)}}}else{a.settings.minYear=r-99}if(a.settings.maxYear){if(typeof a.settings.maxYear=="string"){var o=a.settings.maxYear.substr(0,1);var m=a.settings.maxYear.substr(1);if(o=="+"){a.settings.maxYear=r+parseInt(m)}else if(o=="-"){a.settings.maxYear=r-parseInt(m)}}}else{a.settings.maxYear=r+99}if(a.settings.calendarType==2||a.settings.calendarType==3){var d=null;if(typeof moment!="undefined"){d=moment.locale();moment.locale(Math.random(),{months:a.strings.monthNames,monthsShort:a.strings.monthNamesShort,weekdays:a.strings.dayNames,weekdaysShort:a.strings.dayNamesShort,weekdaysMin:a.strings.dayNamesMin})}a.combodate=a.element.combodate({format:a.settings.format,template:a.settings.template,minYear:a.settings.minYear,maxYear:a.settings.maxYear,firstItem:a.settings.firstItem,smartDays:true,yearDescending:false,customClass:a.settings.customClass});if(d){moment.locale(d)}a.element.siblings(".combodate").children().on("change",function(t){var s=e(this).val();if(s!==""){e(this).siblings().each(function(){if(!e(this).val()){var t=null;if(e(this).hasClass("year")){t=e(this).children('option[value="'+r+'"]').val()}if(!t){t=e(this).children('option[value!=""]:first').val()}if(t){e(this).val(t)}}})}else{e(this).siblings().each(function(){e(this).val("")})}a.element.triggerHandler("cbdatepicker.select",[a,a.element.combodate("getValue")])})}if(a.settings.calendarType==1||a.settings.calendarType==4||a.settings.addPopup){if(a.settings.showTime){a.datetimepicker=a.element.datetimepicker({stepMinute:5,stepSecond:1,altFieldTimeOnly:false,altTimeFormat:a.settings.calendarType==1||a.settings.calendarType==4?a.settings.timeFormat:null,timeFormat:a.settings.calendarType==1||a.settings.calendarType==4?a.settings.timeTemplate:a.settings.timeFormat,amNames:a.strings.amNames,pmNames:a.strings.pmNames,timeOnlyTitle:a.strings.timeOnlyTitle,timeText:a.strings.timeText,hourText:a.strings.hourText,minuteText:a.strings.minuteText,secondText:a.strings.secondText,millisecText:a.strings.millisecText,microsecText:a.strings.microsecText,timezoneText:a.strings.timezoneText,onSelect:function(e){if(a.settings.addPopup){a.element.combodate("setValue",e)}else{a.element.change()}if(a.settings.calendarType==4){a.element.siblings(".cbDatePickerSelected").html(e)}a.element.triggerHandler("cbdatepicker.select",[a,e])},yearRange:a.settings.minYear+":"+a.settings.maxYear,isRTL:a.settings.isRTL,firstDay:a.settings.firstDay,changeMonth:true,changeYear:true,showButtonPanel:false,altField:a.settings.calendarType==1||a.settings.calendarType==4?a.settings.target:null,altFormat:a.settings.calendarType==1||a.settings.calendarType==4?a.settings.dateFormat:null,dateFormat:a.settings.calendarType==1||a.settings.calendarType==4?a.settings.dateTemplate:a.settings.dateFormat,dayNames:a.strings.dayNames,dayNamesMin:a.strings.dayNamesMin,dayNamesShort:a.strings.dayNamesShort,monthNames:a.strings.monthNames,monthNamesShort:a.strings.monthNamesShort,prevText:a.strings.prevText,nextText:a.strings.nextText,currentText:a.strings.currentText,closeText:a.strings.closeText})}else{a.datepicker=a.element.datepicker({onSelect:function(e){if(a.settings.addPopup){a.element.combodate("setValue",e)}else{a.element.change()}if(a.settings.calendarType==4){a.element.siblings(".cbDatePickerSelected").html(e)}a.element.triggerHandler("cbdatepicker.select",[a,e])},yearRange:a.settings.minYear+":"+a.settings.maxYear,isRTL:a.settings.isRTL,firstDay:a.settings.firstDay,changeMonth:true,changeYear:true,showButtonPanel:false,altField:a.settings.calendarType==1||a.settings.calendarType==4?a.settings.target:null,altFormat:a.settings.calendarType==1||a.settings.calendarType==4?a.settings.dateFormat:null,dateFormat:a.settings.calendarType==1||a.settings.calendarType==4?a.settings.dateTemplate:a.settings.dateFormat,dayNames:a.strings.dayNames,dayNamesMin:a.strings.dayNamesMin,dayNamesShort:a.strings.dayNamesShort,monthNames:a.strings.monthNames,monthNamesShort:a.strings.monthNamesShort,prevText:a.strings.prevText,nextText:a.strings.nextText,currentText:a.strings.currentText,closeText:a.strings.closeText})}}a.calendarHandler=function(t){t.preventDefault();var s=a.element.datepicker("widget");if(s.not(":visible").length){a.element.datepicker("show");s.position({my:"left top+20",at:"left top",of:e(this)});if(s.css("z-index")<100){s.css("z-index",100)}}a.element.triggerHandler("cbdatepicker.calendar",[a])};a.element.siblings(".cbDatePickerCalendar").on("click",a.calendarHandler);a.changeHandler=function(t){var i=e(this);if(a.settings.target){i=e(a.settings.target)}i.val(s.get.call(n))};a.element.on("change",a.changeHandler);a.element.on("remove destroy.cbdatepicker",function(){a.element.cbdatepicker("destroy")});a.element.on("rebind.cbdatepicker",function(){a.element.cbdatepicker("rebind")});a.element.on("modified.cbdatepicker",function(e,t,s,i){if(t!=s){a.element.cbdatepicker("rebind")}});a.element.on("cloned.cbdatepicker",function(){e(this).off("destroy.cbdatepicker");e(this).off("rebind.cbdatepicker");e(this).off("cloned.cbdatepicker");e(this).off("modified.cbdatepicker");e(this).removeData("cbdatepicker");e(this).removeData("combodate");e(this).removeData("datepicker");e(this).siblings(".combodate").remove();e(this).removeClass("hasDatepicker");e(this).siblings(".cbDatePickerCalendar").off("click",a.calendarHandler);e(this).off("change",a.changeHandler);e(this).cbdatepicker(a.options)});a.element.triggerHandler("cbdatepicker.init.after",[a]);a.element.data("cbdatepicker",a);t.push(a)})},get:function(){var t=e(this).data("cbdatepicker");if(!t){return""}var s="";if(t.settings.calendarType==2||t.settings.calendarType==3){if(t.settings.showTime){s=e(this).combodate("getValue","YYYY-MM-DD HH:mm:ss")}else{s=e(this).combodate("getValue","YYYY-MM-DD")}}else if(t.settings.calendarType==1||t.settings.calendarType==4){if(t.settings.showTime){s=new Date(e(this).datetimepicker("getDate")).toSQLDateTimeString()}else{s=new Date(e(this).datepicker("getDate")).toSQLDateString()}}if(s&&typeof moment!="undefined"){var i=false;if(t.settings.showTime&&t.settings.offset){s=s+t.settings.offset;i=true}var n=moment(s);if(!i&&t.settings.showTime&&t.settings.timezone&&t.settings.timezone!="UTC"&&typeof moment.tz!="undefined"){n=moment.tz(s,t.settings.timezone);i=true}if(n.isValid()){if(i){n.utc()}s=n.format(t.settings.format)}else{s=""}}return s},set:function(t){var s=e(this).data("cbdatepicker");if(!s){return this}if(s.settings.calendarType==2||s.settings.calendarType==3){e(this).combodate("setValue",t)}else if(s.settings.calendarType==1||s.settings.calendarType==4){if(s.settings.showTime){e(this).datetimepicker("setDate",t)}else{e(this).datepicker("setDate",t)}}return this},rebind:function(){var t=e(this).data("cbdatepicker");if(!t){return this}t.element.cbdatepicker("destroy");t.element.cbdatepicker(t.options);return this},destroy:function(){var s=e(this).data("cbdatepicker");if(!s){return this}if(s.combodate){s.element.combodate("destroy")}if(s.datetimepicker){s.element.datetimepicker("destroy")}if(s.datepicker){s.element.datepicker("destroy")}s.element.siblings(".cbDatePickerCalendar").off("click",s.calendarHandler);s.element.off("change",s.changeHandler);s.element.off("destroy.cbdatepicker");s.element.off("rebind.cbdatepicker");s.element.off("cloned.cbdatepicker");s.element.off("modified.cbdatepicker");e.each(t,function(e,i){if(i.element==s.element){t.splice(e,1);return false}return true});s.element.removeData("cbdatepicker");s.element.triggerHandler("cbdatepicker.destroyed",[s]);return this},instances:function(){return t}};function i(e){if(e<10){return"0"+e}return e}if(!Date.prototype.toSQLDateString){Date.prototype.toSQLDateString=function(){return this.getFullYear()+"-"+i(this.getMonth()+1)+"-"+i(this.getDate())}}if(!Date.prototype.toSQLDateTimeString){Date.prototype.toSQLDateTimeString=function(){return this.getFullYear()+"-"+i(this.getMonth()+1)+"-"+i(this.getDate())+" "+i(this.getHours())+":"+i(this.getMinutes())+":"+i(this.getSeconds())}}e.fn.cbdatepicker=function(e){if(s[e]){return s[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return s.init.apply(this,arguments)}return this};e.fn.cbdatepicker.defaults={init:true,useData:true,calendarType:2,template:"Y-m-d H:i:s",format:"YYYY-MM-DD HH:mm:ss",timeTemplate:"H:i:s",dateTemplate:"Y-m-d",timeFormat:"H:i:s",dateFormat:"Y-m-d",minYear:"-99",maxYear:"+99",firstDay:0,showTime:false,addPopup:false,isRTL:false,customClass:null,firstItem:"empty",timezone:null,offset:null,target:null}})(jQuery);