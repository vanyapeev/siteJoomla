(function($){$.fn.editable=function(t,e){if("disable"==t){$(this).data("disabled.editable",true);return}if("enable"==t){$(this).data("disabled.editable",false);return}if("destroy"==t){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var i=$.extend({},$.fn.editable.defaults,{target:t},e);var a=$.editable.types[i.type].plugin||function(){};var n=$.editable.types[i.type].submit||function(){};var l=$.editable.types[i.type].buttons||$.editable.types["defaults"].buttons;var s=$.editable.types[i.type].content||$.editable.types["defaults"].content;var r=$.editable.types[i.type].element||$.editable.types["defaults"].element;var o=$.editable.types[i.type].reset||$.editable.types["defaults"].reset;var d=i.callback||function(){};var u=i.onedit||function(){};var p=i.onsubmit||function(){};var f=i.onreset||function(){};var c=i.onerror||o;if(i.tooltip){$(this).attr("title",i.tooltip)}i.autowidth="auto"==i.width;i.autoheight="auto"==i.height;return this.each(function(){var t=this;var e=$(t).width();var h=$(t).height();$(this).data("event.editable",i.event);if(!$.trim($(this).html())){$(this).html(i.placeholder)}$(this).bind(i.event,function(f){if(true===$(this).data("disabled.editable")){return}if(t.editing){return}if(false===u.apply(this,[i,t])){return}f.preventDefault();f.stopPropagation();if(i.tooltip){$(t).removeAttr("title")}if(0==$(t).width()){i.width=e;i.height=h}else{if(i.width!="none"){i.width=i.autowidth?$(t).width():i.width}if(i.height!="none"){i.height=i.autoheight?$(t).height():i.height}}if($(this).html().toLowerCase().replace(/(;|"|\/)/g,"")==i.placeholder.toLowerCase().replace(/(;|"|\/)/g,"")){$(this).html("")}t.editing=true;t.revert=$(t).html();$(t).html("");var y=$("<form />");if(i.cssclass){if("inherit"==i.cssclass){y.attr("class",$(t).attr("class"))}else{y.attr("class",i.cssclass)}}if(i.style){if("inherit"==i.style){y.attr("style",$(t).attr("style"));y.css("display",$(t).css("display"))}else{y.attr("style",i.style)}}var b=r.apply(y,[i,t]);var m;if(i.loadurl){var v=setTimeout(function(){b.disabled=true;s.apply(y,[i.loadtext,i,t])},100);var g={};g[i.id]=t.id;if($.isFunction(i.loaddata)){$.extend(g,i.loaddata.apply(t,[t.revert,i]))}else{$.extend(g,i.loaddata)}$.ajax({type:i.loadtype,url:i.loadurl,data:g,async:false,success:function(t){window.clearTimeout(v);m=t;b.disabled=false}})}else if(i.data){m=i.data;if($.isFunction(i.data)){m=i.data.apply(t,[t.revert,i])}}else{m=t.revert}s.apply(y,[m,i,t]);b.attr("name",i.name);l.apply(y,[i,t]);$(t).append(y);a.apply(y,[i,t]);$(":input:visible:enabled:first",y).focus();if(i.select){b.select()}b.keydown(function(e){if(e.keyCode==27){e.preventDefault();o.apply(y,[i,t])}});var v;if("cancel"==i.onblur){b.blur(function(e){v=setTimeout(function(){o.apply(y,[i,t])},500)})}else if("submit"==i.onblur){b.blur(function(t){v=setTimeout(function(){y.submit()},200)})}else if($.isFunction(i.onblur)){b.blur(function(e){i.onblur.apply(t,[b.val(),i])})}else{b.blur(function(t){})}y.submit(function(e){if(v){clearTimeout(v)}e.preventDefault();if(false!==p.apply(y,[i,t])){if(false!==n.apply(y,[i,t])){if($.isFunction(i.target)){var a=i.target.apply(t,[b.val(),i]);$(t).html(a);t.editing=false;d.apply(t,[t.innerHTML,i]);if(!$.trim($(t).html())){$(t).html(i.placeholder)}}else{var l={};l[i.name]=b.val();l[i.id]=t.id;if($.isFunction(i.submitdata)){$.extend(l,i.submitdata.apply(t,[t.revert,i]))}else{$.extend(l,i.submitdata)}if("PUT"==i.method){l["_method"]="put"}$(t).html(i.indicator);var s={type:"POST",data:l,dataType:"html",url:i.target,success:function(e,a){if(s.dataType=="html"){$(t).html(e)}t.editing=false;d.apply(t,[e,i]);if(!$.trim($(t).html())){$(t).html(i.placeholder)}},error:function(e,a,n){c.apply(y,[i,t,e])}};$.extend(s,i.ajaxoptions);$.ajax(s)}}}$(t).attr("title",i.tooltip);return false})});this.reset=function(e){if(this.editing){if(false!==f.apply(e,[i,t])){$(t).html(t.revert);t.editing=false;if(!$.trim($(t).html())){$(t).html(i.placeholder)}if(i.tooltip){$(t).attr("title",i.tooltip)}}}}})};$.editable={types:{defaults:{element:function(t,e){var i=$('<input type="hidden"></input>');$(this).append(i);return i},content:function(t,e,i){$(":input:first",this).val(t)},reset:function(t,e){e.reset(this)},buttons:function(t,e){var i=this;if(t.submit){if(t.submit.match(/>$/)){var a=$(t.submit).click(function(){if(a.attr("type")!="submit"){i.submit()}})}else{var a=$('<button type="submit" />');a.html(t.submit)}$(this).append(a)}if(t.cancel){if(t.cancel.match(/>$/)){var n=$(t.cancel)}else{var n=$('<button type="cancel" />');n.html(t.cancel)}$(this).append(n);$(n).click(function(a){if($.isFunction($.editable.types[t.type].reset)){var n=$.editable.types[t.type].reset}else{var n=$.editable.types["defaults"].reset}n.apply(i,[t,e]);return false})}}},text:{element:function(t,e){var i=$("<input />");if(t.width!="none"){i.width(t.width)}if(t.height!="none"){i.height(t.height)}i.attr("autocomplete","off");$(this).append(i);return i}},textarea:{element:function(t,e){var i=$("<textarea />");if(t.rows){i.attr("rows",t.rows)}else if(t.height!="none"){i.height(t.height)}if(t.cols){i.attr("cols",t.cols)}else if(t.width!="none"){i.width(t.width)}$(this).append(i);return i}},select:{element:function(t,e){var i=$("<select />");$(this).append(i);return i},content:function(data,settings,original){if(String==data.constructor){eval("var json = "+data)}else{var json=data}for(var key in json){if(!json.hasOwnProperty(key)){continue}if("selected"==key){continue}var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){if($(this).val()==json["selected"]||$(this).text()==$.trim(original.revert)){$(this).attr("selected","selected")}});if(!settings.submit){var form=this;$("select",this).change(function(){form.submit()})}}}},addInputType:function(t,e){$.editable.types[t]=e}};$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);