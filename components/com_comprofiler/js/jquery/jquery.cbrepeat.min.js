(function(e){var t=[];var a={init:function(a){return this.each(function(){var s=this;var c=e(s).data("cbrepeat");if(c){return}c={};c.options=typeof a!="undefined"?a:{};c.defaults=e.fn.cbrepeat.defaults;c.settings=e.extend(true,{},c.defaults,c.options);c.element=e(s);if(c.settings.useData){e.each(c.defaults,function(e,t){if(e!="init"&&e!="useData"){var a=c.element.data("cbrepeat"+e.charAt(0).toUpperCase()+e.slice(1));if(typeof a!="undefined"){c.settings[e]=a}else{a=c.element.data("cbrepeat"+e.charAt(0).toUpperCase()+e.slice(1).toLowerCase());if(typeof a!="undefined"){c.settings[e]=a}}}})}if(!c.settings.min){c.settings.min=1}c.element.triggerHandler("cbrepeat.init.before",[c]);if(!c.settings.init){return}if(c.settings.sortable){c.element.sortable({placeholder:c.element.children(".cbRepeatRow").first().attr("class")+" cbRepeatRowPlaceholder",forcePlaceholderSize:true,cursor:"move",items:".cbRepeatRow",containment:"parent",animated:true,stop:function(t,a){var i=[];c.element.children(".cbRepeatRow").find("input:checked").each(function(){i.push(e(this))});n.call(s,c);e.each(i,function(e,t){t.prop("checked",true)});c.element.triggerHandler("cbrepeat.move",[c,t,a])},tolerance:"pointer",handle:".cbRepeatRowMove",opacity:.5})}c.addHandler=function(t){t.preventDefault();var a=c.element.find(".cbRepeatRowAddCount").filter(function(){return e(this).closest(".cbRepeat").is(c.element)});var r=1;if(a.length&&a.val()>0){r=a.val()}if(c.settings.limit&&r>c.settings.limit){r=c.settings.limit;if(a.length){a.val(r)}}for(var n=0;n<r;++n){i.call(s)}};if(c.settings.add){c.element.find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeat").is(c.element)}).on("click",c.addHandler)}c.removeHandler=function(t){t.preventDefault();var a=e(this).closest(".cbRepeatRow");r.call(s,a)};if(c.settings.remove){c.element.find(".cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeat").is(c.element)}).on("click",c.removeHandler)}n.call(s,c);c.element.on("remove destroy.cbrepeat",function(){c.element.cbrepeat("destroy")});c.element.on("rebind.cbrepeat",function(){c.element.cbrepeat("rebind")});c.element.on("modified.cbrepeat",function(e,t,a,i){if(a!=i){c.element.cbrepeat("rebind")}});c.element.bind("cloned.cbrepeat",function(){e(this).off("destroy.cbrepeat");e(this).off("rebind.cbrepeat");e(this).off("cloned.cbrepeat");e(this).off("modified.cbrepeat");e(this).removeData("cbrepeat");e(this).removeData("uiSortable");e(this).removeData("ui-sortable");var t=e(this).find(".cbRepeatRow").first().parent();e(this).find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeat").is(t)}).off("click",c.addHandler);e(this).find(".cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeat").is(t)}).off("click",c.removeHandler);e(this).cbrepeat(c.options)});c.element.triggerHandler("cbrepeat.init.after",[c]);c.element.data("cbrepeat",c);t.push(c)})},add:function(){i.call(this);return this},remove:function(e){r.call(this,e);return this},update:function(){var t=e(this).data("cbrepeat");if(!t){return this}n.call(this,t);return this},reset:function(){var t=e(this).data("cbrepeat");if(!t){return this}var a=t.element.children(".cbRepeatRow:not(:first)");a.find('.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");a.remove();n.call(this,t);return this},rebind:function(){var t=e(this).data("cbrepeat");if(!t){return this}t.element.cbrepeat("cbrepeat");t.element.cbrepeat(t.options);return this},destroy:function(){var a=e(this).data("cbrepeat");if(!a){return this}if(a.settings.sortable){a.element.sortable("destroy");a.element.removeData("uiSortable");a.element.removeData("ui-sortable")}a.element.find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeat").is(a.element)}).off("click",a.addHandler);a.element.find(".cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeat").is(a.element)}).off("click",a.removeHandler);a.element.off("destroy.cbrepeat");a.element.off("rebind.cbrepeat");a.element.off("cloned.cbrepeat");a.element.off("modified.cbrepeat");e.each(t,function(e,i){if(i.element==a.element){t.splice(e,1);return false}return true});a.element.removeData("cbrepeat");a.element.triggerHandler("cbrepeat.destroyed",[a]);return this},instances:function(){return t}};function i(t){var a=e(this).data("cbrepeat");if(!a){return false}if(a.settings.max&&a.element.children(".cbRepeatRow").length>=a.settings.max){return false}var i=a.element.children(".cbRepeatRow").last();var r=[];i.find("input:checked").each(function(){r.push(e(this))});var s=i.clone(true);s.insertAfter(i);var c=s.find("*");if(a.settings.ignore){c=c.not(a.settings.ignore)}c.each(function(){if(e(this).is("input,select,textarea")&&!e(this).hasClass("cbRepeatNoReset")&&!e(this).closest(".cbRepeatNoReset").length){var t=e(this).attr("type");var a=e(this).data("cbrepeat-default");if(typeof a!="undefined"){a=e.trim(a)}else{a=null}if(t=="checkbox"||t=="radio"){if(a){if(t=="checkbox"&&a.indexOf("|*|")!=-1){if(a.split("|*|").indexOf(e(this).val())!=-1){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}else{if(e(this).val()==a){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}}else{if(t=="radio"&&e(this).siblings('input[type="radio"]').length+1==2&&e(this).val()==0){e(this).prop("checked",true)}else{e(this).prop("checked",false)}}if(t=="radio"&&e(this).siblings('input[type="radio"]').length+1==2){if(e(this).val()==0){e(this).next("label").addClass("btn-danger")}else{e(this).next("label").addClass("btn-success")}}if(t=="radio"){e(this).next("label").removeClass("active")}}else{if(a){if(e(this).is("select[multiple]")){a=a.split("|*|")}e(this).val(a)}else{e(this).val("");if(e(this).is("select")){if(!e(this).children('option[value=""]:first').length){e(this).val(e(this).children('option[value!=""]:first').val())}}}}}e(this).triggerHandler("cloned");if(e(this).is("input,select,textarea")){e(this).trigger("change")}});n.call(this,a);e.each(r,function(e,t){t.prop("checked",true)});a.element.triggerHandler("cbrepeat.add",[a]);return true}function r(t){var a=e(this).data("cbrepeat");if(!a){return false}if(a.settings.min&&a.element.children(".cbRepeatRow").length<=a.settings.min){return false}if(!t){t=a.element.children(".cbRepeatRow").last()}t.find('.cbTabs,.cbTooltip,[data-hascbtooltip="true"]').off("remove removeqtip");t.find(".cbRepeat").off("remove");t.remove();n.call(this,a);a.element.triggerHandler("cbrepeat.remove",[a]);return true}function n(t){var a=t.element.children(".cbRepeatRow");if(a.length>t.settings.min){a.find(".cbRepeatRowMove,.cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeatRow").is(a)}).removeClass("hidden");if(t.settings.sortable){t.element.sortable("enable")}}else{a.find(".cbRepeatRowMove,.cbRepeatRowRemove").filter(function(){return e(this).closest(".cbRepeatRow").is(a)}).addClass("hidden");if(t.settings.sortable){t.element.sortable("disable")}}if(t.settings.max){if(a.length>=t.settings.max){a.find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeatRow").is(a)}).addClass("hidden")}else{a.find(".cbRepeatRowAdd").filter(function(){return e(this).closest(".cbRepeatRow").is(a)}).removeClass("hidden")}}if(!t.settings.sortable){a.find(".cbRepeatRowMove").filter(function(){return e(this).closest(".cbRepeatRow").is(a)}).addClass("hidden")}a.each(function(i){var r=e(this).find("*[id],*[for],*[name],*[data-cbrepeat-fallback-id],*[data-cbrepeat-fallback-for],*[data-cbrepeat-fallback-name]").filter(function(){return e(this).closest(".cbRepeatRow").is(a)});if(t.settings.ignore){r=r.not(t.settings.ignore)}r.each(function(){if(e(this).attr("id")||e(this).attr("data-cbrepeat-fallback-id")){var a="id";if(!e(this).attr("id")){a="data-cbrepeat-fallback-id"}var r=e(this).attr(a);if(!e(this).data("orgId")){e(this).data("orgId",e(this).attr(a))}e(this).attr(a,e(this).attr(a).replace(/^(.*__)(\d+)(__\w+)$/g,"$1"+i+"$3"));var n=e(this).attr(a);e(this).triggerHandler("modified",[r,n,i]);var s=r.replace("cbfr_","").replace("cbfv_","").replace(/__[a-zA-Z0-9]+$/g,"");var c=n.replace("cbfr_","").replace("cbfv_","").replace(/__[a-zA-Z0-9]+$/g,"");if(s!==c){var l=e(this).closest(".cbRepeatRow").find('*[id*="'+s+'"],*[id*="'+s.replace(/_{2,}/g,"__")+'"],*[data-cbrepeat-fallback-id*="'+s+'"],*[id*="'+s.replace(/_{2,}/g,"__")+'"]');if(t.settings.ignore){l=l.not(t.settings.ignore)}l.each(function(){if(e(this).attr("id")){var t=e(this).attr("id");if(!e(this).data("orgId")){e(this).data("orgId",e(this).attr("id"))}e(this).attr("id",e(this).attr("id").replace(s,c).replace(s.replace(/_{2,}/g,"__"),c.replace(/_{2,}/g,"__")));var a=e(this).attr("id");if(typeof cbHideFields!="undefined"){var r=[];e.each(cbHideFields,function(e,a){if(a[0]==t||a[1]==t){r.push(a)}});e.each(r,function(t,a){var i=[];i[0]=a[0].replace(s,c).replace(s.replace(/_{2,}/g,"__"),c.replace(/_{2,}/g,"__"));i[1]=a[1].replace(s,c).replace(s.replace(/_{2,}/g,"__"),c.replace(/_{2,}/g,"__"));i[2]=a[2];i[3]=a[3];i[4]=[];e.each(a[4],function(e,t){i[4].push(t.replace(s,c).replace(s.replace(/_{2,}/g,"__"),c.replace(/_{2,}/g,"__")))});i[5]=[];e.each(a[5],function(e,t){i[5].push(t.replace(s,c).replace(s.replace(/_{2,}/g,"__"),c.replace(/_{2,}/g,"__")))});var r=false;e.each(cbHideFields,function(e,t){if(t[0]==i[0]&&t[1]==i[1]&&t[2]==i[2]&&t[3]==i[3]){r=true}});if(!r){cbHideFields.push(i)}})}e(this).triggerHandler("modified",[t,a,i])}if(e(this).attr("data-cbrepeat-fallback-id")){e(this).attr("data-cbrepeat-fallback-id",e(this).attr("data-cbrepeat-fallback-id").replace(s,c).replace(s.replace(/_{2,}/g,"__"),c.replace(/_{2,}/g,"__")))}})}}if(e(this).attr("for")||e(this).attr("data-cbrepeat-fallback-for")){var o="for";if(!e(this).attr("for")){o="data-cbrepeat-fallback-for"}var f=e(this).attr(o).replace(/__[a-zA-Z0-9]+$/g,"");if(!e(this).data("orgFor")){e(this).data("orgFor",e(this).attr(o))}e(this).attr(o,e(this).attr(o).replace(/^(.*__)(\d+)(__\w+)$/g,"$1"+i+"$3"));var d=e(this).attr(o).replace(/__[a-zA-Z0-9]+$/g,"");if(f!==d){var p=e(this).closest(".cbRepeatRow").find('*[for*="'+f+'"],*[data-cbrepeat-fallback-for*="'+f+'"]');if(t.settings.ignore){p=p.not(t.settings.ignore)}p.each(function(){if(e(this).attr("for")){e(this).attr("for",e(this).attr("for").replace(f,d))}if(e(this).attr("data-cbrepeat-fallback-for")){e(this).attr("data-cbrepeat-fallback-for",e(this).attr("data-cbrepeat-fallback-for").replace(f,d))}})}}if(e(this).attr("name")||e(this).attr("data-cbrepeat-fallback-name")){var h="name";if(!e(this).attr("name")){h="data-cbrepeat-fallback-name"}var b=e(this).attr(h).replace(/\[[a-zA-Z0-9]+\]$/g,"");if(!e(this).data("orgName")){e(this).data("orgName",e(this).attr(h))}e(this).attr(h,e(this).attr(h).replace(/^(.*)(\[\d+\])(\[\w+\])$/g,"$1["+i+"]$3"));var u=e(this).attr(h).replace(/\[[a-zA-Z0-9]+\]$/g,"");if(b!==u){var m=e(this).closest(".cbRepeatRow").find('*[name*="'+b+'"],*[data-cbrepeat-fallback-name*="'+b+'"]');if(t.settings.ignore){m=m.not(t.settings.ignore)}m.each(function(){if(e(this).attr("name")){e(this).attr("name",e(this).attr("name").replace(b,u))}if(e(this).attr("data-cbrepeat-fallback-name")){e(this).attr("data-cbrepeat-fallback-name",e(this).attr("data-cbrepeat-fallback-name").replace(b,u))}})}}})});if(typeof cbHideFields!="undefined"){var i=[];e.each(cbHideFields,function(t,a){if(!e("#"+a[0]).length){i.push(a)}});e.each(i,function(e,t){cbHideFields.splice(cbHideFields.indexOf(t),1)})}if(typeof cbInitFields!="undefined"){cbInitFields()}if(a.length==t.settings.min){t.element.addClass("cbRepeatMin")}else if(a.length==t.settings.max){t.element.addClass("cbRepeatMax")}else{t.element.removeClass("cbRepeatMin cbRepeatMax")}t.element.triggerHandler("cbrepeat.updated",[t])}e.fn.cbrepeat=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof e==="object"||!e){return a.init.apply(this,arguments)}return this};e.fn.cbrepeat.defaults={init:true,useData:true,sortable:true,ignore:null,add:true,remove:true,min:1,max:0,limit:25}})(jQuery);