(function(i){var e=i(window),t,n,o=-1,a,l,s,r,c,d,u,f=!window.XMLHttpRequest,h=[],p=document.documentElement,y={},g=new Image,m=new Image,v,b,w,x,k,D,L,I,T,z;i(function(){i("body").append(i([v=i('<div id="lbOverlay" />').click(M)[0],b=i('<div id="lbCenter" />')[0],L=i('<div id="lbBottomContainer" />')[0]]).css("display","none"));w=i('<div id="lbImage" />').appendTo(b).append(x=i('<div style="position: relative;" />').append([k=i('<a id="lbPrevLink" href="#" />').click(C)[0],D=i('<a id="lbNextLink" href="#" />').click(E)[0]])[0])[0];I=i('<div id="lbBottom" />').appendTo(L).append([i('<a id="lbCloseLink" href="#" />').click(M)[0],T=i('<div id="lbCaption" />')[0],z=i('<div id="lbNumber" />')[0],i('<div style="clear: both;" />')[0]])[0]});i.slimbox=function(o,a,l){t=i.extend({loop:false,overlayOpacity:.8,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initialHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"Image {x} of {y}",closeKeys:[27,88,67],previousKeys:[37,80],nextKeys:[39,78]},l);if(typeof o=="string"){o=[[o,a]];a=0}c=e.scrollTop()+e.height()/2;d=t.initialWidth;u=t.initialHeight;i(b).css({top:Math.max(0,c-u/2),width:d,height:u,marginLeft:-d/2}).show();r=f||v.currentStyle&&v.currentStyle.position!="fixed";if(r)v.style.position="absolute";i(v).css("opacity",t.overlayOpacity).fadeIn(t.overlayFadeDuration);H();K(1);n=o;t.loop=t.loop&&n.length>1;return N(a)};i.fn.slimbox=function(e,t,n){t=t||function(i){return[i.href,i.title]};n=n||function(){return true};var o=this;return o.unbind("click").click(function(){var a=this,l=0,s,r=0,c;s=i.grep(o,function(i,e){return n.call(a,i,e)});for(c=s.length;r<c;++r){if(s[r]==a)l=r;s[r]=t(s[r],r)}return i.slimbox(s,l,e)})};function H(){var t=e.scrollLeft(),n=e.width();i([b,L]).css("left",t+n/2);if(r)i(v).css({left:t,top:e.scrollTop(),width:n,height:e.height()})}function K(t){if(t){i("object").add(f?"select":"embed").each(function(i,e){h[i]=[e,e.style.visibility];e.style.visibility="hidden"})}else{i.each(h,function(i,e){e[0].style.visibility=e[1]});h=[]}var n=t?"bind":"unbind";e[n]("scroll resize",H);i(document)[n]("keydown",F)}function F(e){var n=e.which,o=i.inArray;return o(n,t.closeKeys)>=0?M():o(n,t.nextKeys)>=0?E():o(n,t.previousKeys)>=0?C():null}function C(){return N(l)}function E(){return N(s)}function N(i){if(i>=0){o=i;a=n[o][0];l=(o||(t.loop?n.length:0))-1;s=(o+1)%n.length||(t.loop?0:-1);A();b.className="lbLoading";y=new Image;y.onload=O;y.src=a}return false}function O(){b.className="";i(w).css({backgroundImage:"url("+a+")",visibility:"hidden",display:""});i(x).width(y.width);i([x,k,D]).height(y.height);i(T).html(n[o][1]||"");i(z).html((n.length>1&&t.counterText||"").replace(/{x}/,o+1).replace(/{y}/,n.length));if(l>=0)g.src=n[l][0];if(s>=0)m.src=n[s][0];d=w.offsetWidth;u=w.offsetHeight;var e=Math.max(0,c-u/2);if(b.offsetHeight!=u){i(b).animate({height:u,top:e},t.resizeDuration,t.resizeEasing)}if(b.offsetWidth!=d){i(b).animate({width:d,marginLeft:-d/2},t.resizeDuration,t.resizeEasing)}i(b).queue(function(){i(L).css({width:d,top:e+u,marginLeft:-d/2,visibility:"hidden",display:""});i(w).css({display:"none",visibility:"",opacity:""}).fadeIn(t.imageFadeDuration,W)})}function W(){if(l>=0)i(k).show();if(s>=0)i(D).show();i(I).css("marginTop",-I.offsetHeight).animate({marginTop:0},t.captionAnimationDuration);L.style.visibility=""}function A(){y.onload=null;y.src=g.src=m.src=a;i([b,w,I]).stop(true);i([k,D,w,L]).hide()}function M(){if(o>=0){A();o=l=s=-1;i(b).hide();i(v).stop().fadeOut(t.overlayFadeDuration,K)}return false}})(jQuery);